<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Thá»­ ThÃ¡ch VÃ´ Cá»±c - PhiÃªn Báº£n NCT</title>
<style>
:root{--gold:#ffd700;--neon:#00f3ff;--bg:#050505;--panel:#1a1a1a;--wrong:#ff0044;--right:#00ff88;}
body{margin:0;font-family:'Segoe UI',sans-serif;background:var(--bg);color:#fff;display:flex;justify-content:center;align-items:center;min-height:100vh;overflow:hidden;user-select:none}
.box{width:95%;max-width:600px;background:var(--panel);border:1px solid #333;border-radius:20px;padding:25px;box-shadow:0 0 50px rgba(0,243,255,0.1);position:relative;display:flex;flex-direction:column;min-height:600px}

/* HEADER & FOOTER */
.intro-text{text-align:center;color:#888;font-size:0.9em;font-style:italic;margin-top:30px;line-height:1.6;border-top:1px solid #333;padding-top:15px}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;font-weight:bold;color:var(--gold)}

/* LIFELINES */
.lifelines{display:flex;justify-content:space-between;margin-bottom:20px;gap:10px}
.life-btn{flex:1;aspect-ratio:1;background:#222;border:1px solid #444;border-radius:10px;font-size:1.5em;cursor:pointer;transition:.2s;display:flex;align-items:center;justify-content:center;position:relative}
.life-btn:hover:not(.locked):not(.used){background:#333;border-color:var(--neon);color:var(--neon)}
.life-btn.locked{opacity:0.5;cursor:not-allowed;background:#111}
.life-btn.locked::after{content:'ğŸ”’';position:absolute;font-size:0.6em;top:2px;right:2px}
.life-btn.used{opacity:0.3;cursor:default;filter:grayscale(1)}
.life-btn.used::before{content:'âŒ';position:absolute;color:red;font-size:1.5em;z-index:2}

/* GAMEPLAY */
#timer{font-size:3.5em;text-align:center;font-weight:900;color:var(--neon);text-shadow:0 0 20px var(--neon);margin:5px 0;font-family:monospace}
#question{font-size:1.25em;text-align:center;min-height:90px;display:flex;align-items:center;justify-content:center;margin:15px 0;line-height:1.4;font-weight:500}
.options-grid{display:grid;gap:10px;margin-top:auto}
.option{padding:15px;background:#2a2a2a;border:1px solid #444;border-radius:10px;cursor:pointer;transition:.2s;font-size:1.05em;position:relative;overflow:hidden; display:flex; align-items:center;}
.option:hover{background:#333;border-color:var(--neon)}
.option.correct{background:var(--right)!important;color:#000;font-weight:bold}
.option.wrong{background:var(--wrong)!important;color:#fff}
.option.hidden-50{opacity:0;pointer-events:none}

/* SCREENS */
.hidden{display:none!important}
.start-screen{text-align:center;padding:10px; display:flex; flex-direction:column; justify-content:center; height:100%;}
.start-screen h1{color:var(--neon);font-size:2.5em;text-transform:uppercase;margin-bottom:10px;letter-spacing:2px; text-shadow: 0 0 10px rgba(0,243,255,0.5);}
.start-screen p {margin-bottom: 30px;}
.inp-name{width:80%;padding:15px;background:#111;border:2px solid var(--neon);color:#fff;font-size:1.2em;text-align:center;margin:0 auto 20px auto;border-radius:50px;outline:none}
.btn-main{padding:15px 50px;background:var(--gold);color:#000;font-weight:bold;font-size:1.2em;border:none;border-radius:50px;cursor:pointer;transition:0.3s;text-transform:uppercase; width: fit-content; margin: 0 auto;}
.btn-main:hover{transform:scale(1.05);box-shadow:0 0 20px var(--gold)}

/* OVERLAY */
#overlay{position:absolute;inset:0;background:rgba(0,0,0,0.95);z-index:100;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:20px;text-align:center;border-radius:20px}
#ov-content{font-size:1.2em;margin:20px 0;line-height:1.6}
.close-btn{padding:10px 30px;background:var(--neon);border:none;border-radius:5px;font-weight:bold;cursor:pointer}

</style>
</head>
<body>

<div class="box">
  <div id="screen-start" class="start-screen">
    <div style="flex-grow:1; display:flex; flex-direction:column; justify-content:center;">
        <h1>ThÃ¡nh Troll<br>Äáº¡i Chiáº¿n</h1>
        <p style="color:#666;font-size:0.9em">ğŸ”¥ Cáº£nh bÃ¡o: ÄÃ¡p Ã¡n cá»±c ká»³ lÆ°Æ¡n láº¹o!</p>
        <input type="text" id="inp-name" class="inp-name" placeholder="Nháº­p danh tÃ­nh vÃ o Ä‘Ã¢y..." autocomplete="off">
        <button class="btn-main" onclick="game.start()">Báº¯t Ä‘áº§u</button>
    </div>
    
    <div class="intro-text">
        Xin chÃ o Báº¡n yÃªu, hÃ´m nay má»‡t má»i hay nhiá»u niá»m vui?<br>
        ThÆ° giÃ£n, giáº£i trÃ­ 1 chÃºt nhÃ©, hy vá»ng sau khi chÆ¡i báº¡n khÃ´ng cay cÃº ğŸ˜†<br>
        ÄÃ¢y lÃ  mini game cá»§a NCT...
    </div>
  </div>

  <div id="screen-play" class="hidden" style="display:flex; flex-direction:column; height:100%">
    <div class="header">
        <span id="player-display">Player</span>
        <span id="level-indicator" style="background:var(--gold);color:#000;padding:2px 10px;border-radius:10px">CÃ‚U 1/15</span>
    </div>

    <div class="lifelines">
        <div class="life-btn" id="btn-5050" onclick="game.useLife('5050')" title="50:50">âš–ï¸</div>
        <div class="life-btn" id="btn-phone" onclick="game.useLife('phone')" title="Gá»i ngÆ°á»i thÃ¢n">ğŸ“</div>
        <div class="life-btn locked" id="btn-audience" onclick="game.useLife('audience')" title="Há»i Ã½ kiáº¿n khÃ¡n giáº£ (Má»Ÿ á»Ÿ cÃ¢u 10)">ğŸ‘¥</div>
        <div class="life-btn locked" id="btn-expert" onclick="game.useLife('expert')" title="Tá»• tÆ° váº¥n (Má»Ÿ á»Ÿ cÃ¢u 14)">ğŸ§™</div>
    </div>

    <div id="timer">15</div>
    <div id="question">Loading...</div>
    <div class="options-grid" id="options"></div>
  </div>
</div>

<div id="overlay" class="hidden">
    <h2 id="ov-title" style="color:var(--gold);margin:0">TITLE</h2>
    <div id="ov-content">Content</div>
    <button class="close-btn" onclick="game.closeOverlay()">ÄÃƒ HIá»‚U</button>
</div>

<script>
/* ================= DATABASE ================= */
// Level 1: Dá»… nhÆ°ng Ä‘Ã¡p Ã¡n nhiá»…u (CÃ¢u 1-6)
const DB_EASY = [
    {q:"1 kg sáº¯t vÃ  1 kg bÃ´ng, cÃ¡i nÃ o náº·ng hÆ¡n?", o:["Sáº¯t (Trá»ng lÆ°á»£ng riÃªng lá»›n hÆ¡n)","BÃ´ng (Thá»ƒ tÃ­ch lá»›n hÆ¡n)","Báº±ng nhau (Äá»u lÃ  1kg)","TÃ¹y vÃ o lá»±c hÃºt TrÃ¡i Äáº¥t"], c:2},
    {q:"ThÃ¡ng nÃ o trong nÄƒm cÃ³ 28 ngÃ y?", o:["Chá»‰ cÃ³ ThÃ¡ng 2","ThÃ¡ng 2 (NÄƒm khÃ´ng nhuáº­n)","Táº¥t cáº£ cÃ¡c thÃ¡ng","ThÃ¡ng 2 vÃ  cÃ¡c thÃ¡ng cháºµn"], c:2},
    {q:"Máº·t trá»i má»c hÆ°á»›ng ÄÃ´ng, láº·n hÆ°á»›ng TÃ¢y. Váº­y sao Kim má»c hÆ°á»›ng nÃ o?", o:["HÆ°á»›ng ÄÃ´ng","HÆ°á»›ng TÃ¢y","HÆ°á»›ng Nam","HÆ°á»›ng Báº¯c"], c:1}, 
    {q:"BÃ¡nh chÆ°ng hÃ¬nh gÃ¬?", o:["HÃ¬nh vuÃ´ng (TÆ°á»£ng trÆ°ng Äáº¥t)","HÃ¬nh há»™p chá»¯ nháº­t","HÃ¬nh láº­p phÆ°Æ¡ng","HÃ¬nh trÃ²n (TÆ°á»£ng trÆ°ng Trá»i)"], c:0}, 
    {q:"CÃ¡i gÃ¬ tay trÃ¡i cáº§m Ä‘Æ°á»£c cÃ²n tay pháº£i thÃ¬ khÃ´ng?", o:["Khuá»·u tay trÃ¡i","Khuá»·u tay pháº£i","Cá»• tay trÃ¡i","LÃ²ng bÃ n tay trÃ¡i"], c:1},
    {q:"Khi báº¯n sÃºng ngÆ°á»i ta nháº¯m máº¯t nÃ o?", o:["Máº¯t trÃ¡i","Máº¯t pháº£i","Nháº¯m má»™t máº¯t (báº¥t ká»³)","Má»Ÿ cáº£ 2 Ä‘á»ƒ quan sÃ¡t"], c:2},
    {q:"Con gÃ¬ Ä‘áº­p thÃ¬ sá»‘ng, khÃ´ng Ä‘áº­p thÃ¬ cháº¿t?", o:["Con quay (Beyblade)","Con tim","Con cÃ¡ Ä‘ang bÆ¡i","Con láº­t Ä‘áº­t"], c:1},
    {q:"SÃ´ng gÃ¬ khÃ´ng cÃ³ nÆ°á»›c?", o:["SÃ´ng Há»“ng (MÃ¹a cáº¡n)","SÃ´ng NgÃ¢n HÃ ","SÃ´ng Cá»­u Long","SÃ´ng Tiá»n"], c:1},
    {q:"Xe nÃ o khÃ´ng bao giá» giáº£m Ä‘i?", o:["Xe khÃ¡ch","Xe buÃ½t","Xe tÄƒng (TÄƒng lÃªn)","Xe Ä‘áº¡p"], c:2}, 
    {q:"CÃ¡i gÃ¬ ngÆ°á»i mua biáº¿t, ngÆ°á»i bÃ¡n biáº¿t, ngÆ°á»i dÃ¹ng khÃ´ng bao giá» nhÃ¬n tháº¥y?", o:["BÃ­ máº­t quá»‘c gia","Há»™p Ä‘en mÃ¡y bay","Quan tÃ i","LÆ°Æ¡ng cá»§a vá»£"], c:2}
];

// Level 2: Hack nÃ£o & ÄÃ¡p Ã¡n báº«y cá»±c máº¡nh (CÃ¢u 7-15)
const DB_HARD = [
    {q:"Ba cá»§a Mary cÃ³ 5 con: Nana, Nene, Nini, Nono. NgÆ°á»i thá»© 5 tÃªn gÃ¬?", o:["Nunu (Theo quy luáº­t)","Nina (TÃªn phá»• biáº¿n)","Mary","Ba cá»§a Mary"], c:2},
    {q:"Náº¿u hÃ´m nay lÃ  Thá»© Hai, thÃ¬ ngÃ y mai cá»§a ngÃ y hÃ´m qua lÃ  ngÃ y gÃ¬?", o:["Thá»© Hai","Thá»© Ba","Chá»§ Nháº­t","Thá»© TÆ°"], c:0},
    {q:"LÃ m sao Ä‘á»ƒ cÃ³ con cua 9 chÃ¢n?", o:["TÃ¬m con Ä‘á»™t biáº¿n gen","Luá»™c nÃ³ lÃªn (ChÃ­n chÃ¢n)","Cáº¯t bá»›t 1 chÃ¢n","Gáº¯n thÃªm chÃ¢n giáº£"], c:1},
    {q:"0 chia cho máº¥y thÃ¬ báº±ng 2?", o:["0","2","1","KhÃ´ng cÃ³ sá»‘ nÃ o"], c:3},
    {q:"Äá»‰nh nÃºi cao nháº¥t tháº¿ giá»›i trÆ°á»›c khi Everest Ä‘Æ°á»£c tÃ¬m ra?", o:["Äá»‰nh K2 (Cao thá»© 2)","Äá»‰nh Kangchenjunga","Váº«n lÃ  Everest","ChÆ°a cÃ³ Ä‘á»‰nh nÃ o"], c:2},
    {q:"Tá»« nÃ o 100% ngÆ°á»i Viá»‡t phÃ¡t Ã¢m sai?", o:["Tá»« 'Sai'","Tá»« 'NghiÃªng'","Tá»« 'Ngá»ng'","Tá»« 'Lá»—i'"], c:0},
    {q:"Gia Ä‘Ã¬nh 5 anh trai, má»—i ngÆ°á»i cÃ³ 1 em gÃ¡i. NhÃ  cÃ³ máº¥y ngÆ°á»i con?", o:["6 ngÆ°á»i","10 ngÆ°á»i (5 trai 5 gÃ¡i)","11 ngÆ°á»i","5 ngÆ°á»i"], c:0},
    {q:"BÃºt + Táº©y = 11k. BÃºt Ä‘áº¯t hÆ¡n Táº©y 10k. GiÃ¡ cÃ¡i Táº©y?", o:["1k (11-10=1)","500Ä‘","1.5k","2k"], c:1}, 
    {q:"Má»™t ngÆ°á»i Ä‘i dÆ°á»›i mÆ°a khÃ´ng Ä‘á»™i mÅ©, khÃ´ng Ã´ mÃ  tÃ³c khÃ´ng Æ°á»›t?", o:["Do Ä‘i quÃ¡ nhanh","Do máº·c Ã¡o mÆ°a trÃ¹m Ä‘áº§u","Do ngÆ°á»i Ä‘Ã³ bá»‹ hÃ³i","Do trá»i mÆ°a bÃ³ng mÃ¢y"], c:2},
    {q:"Sá»Ÿ thÃº bá»‹ chÃ¡y, con gÃ¬ cháº¡y ra Ä‘áº§u tiÃªn?", o:["Con Voi (To nháº¥t)","Con BÃ¡o (Nhanh nháº¥t)","Con NgÆ°á»i","Con Chim (Bay ra)"], c:2},
    {q:"Báº¡n Ä‘ang Ä‘á»©ng thá»© 2, báº¡n vÆ°á»£t qua ngÆ°á»i thá»© 2. Báº¡n Ä‘á»©ng thá»© máº¥y?", o:["Thá»© Nháº¥t (VÃ´ Ä‘á»‹ch)","Thá»© Hai","Thá»© Ba","Thá»© TÆ°"], c:1},
    {q:"CÃ³ 10 ngÃ³n tay trong 1 cÃ¡i há»™p. ÄÃ³ lÃ  gÃ¬?", o:["Há»™p Ä‘á»±ng ngÃ³n tay giáº£","ÄÃ´i gÄƒng tay","Má»™t vá»¥ Ã¡n máº¡ng","Há»™p quÃ  bÃ­ áº©n"], c:1},
    {q:"ThÃ¡ng nÃ o ngáº¯n nháº¥t trong nÄƒm?", o:["ThÃ¡ng 2 (Ãt ngÃ y nháº¥t)","ThÃ¡ng 5 (TÃªn ngáº¯n nháº¥t)","ThÃ¡ng Ba (Ba ngÃ£ TÆ°)","ThÃ¡ng TÆ°"], c:2}, 
    {q:"CÃ¡i gÃ¬ thuá»™c vá» báº¡n nhÆ°ng ngÆ°á»i khÃ¡c dÃ¹ng nhiá»u hÆ¡n?", o:["Tiá»n báº¡c","TÃªn cá»§a báº¡n","Äiá»‡n thoáº¡i","Thá»i gian"], c:1}
];

/* ================= GAME LOGIC ================= */
const game = {
    user: { name: "", gender: "báº¡n" },
    currentQ: 0,
    questions: [],
    lifelines: { '5050': true, 'phone': true, 'audience': true, 'expert': true },
    isPaused: false,
    timer: 15,
    interval: null,

    start() {
        const name = document.getElementById('inp-name').value.trim();
        if (!name) { alert("Nháº­p cÃ¡i tÃªn vÃ o Ä‘i báº¡n Æ¡i, Ä‘á»«ng lÆ°á»i!"); return; }
        
        this.user.name = name;
        this.detectGender(name);
        this.questions = this.generateSmartPack();
        this.currentQ = 0;
        this.lifelines = { '5050': true, 'phone': true, 'audience': true, 'expert': true };
        this.resetUI();

        document.getElementById('screen-start').classList.add('hidden');
        document.getElementById('screen-play').classList.remove('hidden');
        document.getElementById('player-display').innerText = `NgÆ°á»i chÆ¡i: ${this.user.name}`;
        
        this.loadQuestion();
    },

    generateSmartPack() {
        let played = JSON.parse(localStorage.getItem('nct_played_ids') || '[]');
        
        const getUnused = (pool, count) => {
            let unused = pool.filter(q => !played.includes(q.q));
            if (unused.length < count) {
                played = []; 
                localStorage.setItem('nct_played_ids', '[]');
                unused = pool;
            }
            return unused.sort(() => Math.random() - 0.5).slice(0, count);
        };

        return [...getUnused(DB_EASY, 6), ...getUnused(DB_HARD, 9)];
    },

    detectGender(name) {
        const n = name.toLowerCase();
        const male = ['hÃ¹ng','cÆ°á»ng','nam','tuáº¥n','Ä‘áº¡t','sÆ¡n','trung','dÅ©ng','minh','quang','khÃ¡nh','duy','tháº¯ng','kiÃªn','huy','hoÃ ng','long'];
        const female = ['lan','hoa','huá»‡','trang','linh','tháº£o','vy','háº±ng','tuyáº¿t','nhung','phÆ°Æ¡ng','hÃ ','thá»§y','anh','ngá»c','mai'];
        
        if (male.some(k => n.includes(k))) this.user.gender = "anh trai";
        else if (female.some(k => n.includes(k))) this.user.gender = "chá»‹ gÃ¡i";
        else this.user.gender = "báº¡n yÃªu";
    },

    // --- HÃ€M TÃNH GIáº¢I THÆ¯á»NG Má»šI THÃŠM VÃ€O ---
    getPrizeText(qNum) {
        const g = (this.user.gender || "").toLowerCase();
        const isMale = g.includes("anh") || g.includes("nam") || g.includes("trai");
        const titleNam = "anh trai";
        const titleNu = "chá»‹ Ä‘áº¹p";

        // Má»‘c 1: Sai tá»« cÃ¢u 1-4
        if(qNum <= 4) {
            return "ğŸ‘ Giáº£i thÆ°á»Ÿng: 1 trÃ ng vá»— tay cho sá»± cá»‘ gáº¯ng (cÃ²n non láº¯m)!";
        }
        // Má»‘c 2: ÄÃºng cÃ¢u 5 (tá»©c Ä‘ang á»Ÿ cÃ¢u 6 hoáº·c sai á»Ÿ cÃ¢u 5,6)
        if(qNum >= 5 && qNum < 7) {
            return "ğŸ­ Giáº£i thÆ°á»Ÿng: 1 cÃ¢y káº¹o mÃºt siÃªu ngá»t ngÃ o!";
        }
        // Má»‘c 3: Tá»« cÃ¢u 7-9
        if(qNum >= 7 && qNum <= 9) {
            return "ğŸ¿ Giáº£i thÆ°á»Ÿng: 1 gÃ³i bim bim tháº§n thÃ¡nh Äƒn cho Ä‘á»¡ buá»“n!";
        }
        // Má»‘c 4: Tá»« cÃ¢u 10 trá»Ÿ Ä‘i (Cafe/TrÃ  sá»¯a Size L)
        if(qNum >= 10 && qNum <= 14) {
            return isMale 
                ? `â˜• Giáº£i thÆ°á»Ÿng: 1 cá»‘c Cafe size L cho ${titleNam} tá»‰nh tÃ¡o!` 
                : `ğŸ§‹ Giáº£i thÆ°á»Ÿng: 1 ly TrÃ  sá»¯a size L cho ${titleNu} háº¡ há»a!`;
        }
        // Má»‘c 5: ÄÃºng cÃ¢u 14 (Sai á»Ÿ cÃ¢u 15 hoáº·c dá»«ng)
        if(qNum === 15) {
            return isMale
                ? "â˜• Giáº£i thÆ°á»Ÿng: Cafe size XX â€“ Full topping uá»‘ng no nÃª!"
                : "ğŸ§‹ Giáº£i thÆ°á»Ÿng: TrÃ  sá»¯a size XX â€“ Full topping uá»‘ng quÃªn lá»‘i vá»!";
        }
        return "";
    },

    loadQuestion() {
        clearInterval(this.interval);
        this.isPaused = false;
        const qData = this.questions[this.currentQ];
        const qNum = this.currentQ + 1;

        let played = JSON.parse(localStorage.getItem('nct_played_ids') || '[]');
        if(!played.includes(qData.q)) {
            played.push(qData.q);
            localStorage.setItem('nct_played_ids', JSON.stringify(played));
        }

        this.timer = 15;
        document.getElementById('timer').innerText = this.timer;
        document.getElementById('level-indicator').innerText = `CÃ‚U ${qNum}/15`;
        document.getElementById('question').innerText = qData.q;
        
        const grid = document.getElementById('options');
        grid.innerHTML = '';
        grid.style.pointerEvents = 'auto';

        qData.o.forEach((opt, idx) => {
            const btn = document.createElement('div');
            btn.className = 'option';
            btn.innerHTML = `<b style="color:var(--gold);margin-right:10px">${String.fromCharCode(65+idx)}.</b> ${opt}`;
            btn.onclick = () => this.checkAnswer(idx);
            grid.appendChild(btn);
        });

        this.updateLifelineLocks(qNum);

        this.interval = setInterval(() => {
            if(!this.isPaused) {
                this.timer--;
                document.getElementById('timer').innerText = this.timer;
                if(this.timer <= 0) this.gameOver(true);
            }
        }, 1000);
    },

    updateLifelineLocks(qNum) {
        const btnAud = document.getElementById('btn-audience');
        if(qNum < 10) {
            btnAud.classList.add('locked');
            btnAud.onclick = () => alert(`ğŸ”’ KhÃ¡n giáº£ chÆ°a Ä‘Æ°á»£c vÃ o sÃ¢n!\nVÆ°á»£t qua cÃ¢u 9 Ä‘á»ƒ má»Ÿ khÃ³a.`);
        } else if (this.lifelines['audience']) {
            btnAud.classList.remove('locked');
            btnAud.onclick = () => this.useLife('audience');
        }

        const btnExp = document.getElementById('btn-expert');
        if(qNum < 14) {
            btnExp.classList.add('locked');
            btnExp.onclick = () => alert(`ğŸ”’ Tá»• tÆ° váº¥n Ä‘ang báº­n!\nChá»‰ há»— trá»£ 2 cÃ¢u cuá»‘i cÃ¹ng (Tá»« cÃ¢u 14).`);
        } else if (this.lifelines['expert']) {
            btnExp.classList.remove('locked');
            btnExp.onclick = () => this.useLife('expert');
        }
    },

    checkAnswer(idx) {
        clearInterval(this.interval);
        const qData = this.questions[this.currentQ];
        const opts = document.querySelectorAll('.option');
        document.getElementById('options').style.pointerEvents = 'none';

        if(idx === qData.c) {
            opts[idx].classList.add('correct');
            setTimeout(() => {
                this.currentQ++;
                if(this.currentQ === 15) this.victory();
                else this.loadQuestion();
            }, 1000);
        } else {
            opts[idx].classList.add('wrong');
            opts[qData.c].classList.add('correct');
            setTimeout(() => this.gameOver(false), 2000);
        }
    },

    // --- Cáº¬P NHáº¬T LOGIC GAME OVER Äá»‚ HIá»†N GIáº¢I THÆ¯á»NG ---
    gameOver(isTimeout) {
        const { name, gender } = this.user;
        const qNum = this.currentQ + 1;
        
        let title = isTimeout ? "ğŸ¢ Háº¾T GIá»œ Rá»’I" : "âŒ TOANG Rá»’I";
        let msg = "";
        
        // Láº¥y text giáº£i thÆ°á»Ÿng
        let prize = this.getPrizeText(qNum);

        if (qNum <= 4) {
            msg = `Trá»i Ä‘áº¥t Æ¡i ${name}! CÃ¢u sÆ¡ sinh mÃ  cÅ©ng trÆ°á»£t ğŸ¤£<br>
                   ${gender} lÃ m admin tháº¥t vá»ng ghÃª!<br>
                   <b>(Dá»«ng á»Ÿ cÃ¢u ${qNum} - Rank: GÃ  Má»)</b><br><br>${prize}`;
        } else if (qNum <= 9) {
            msg = `${name} chÆ¡i cÅ©ng á»•n Ã¡p Ä‘Ã³!<br>
                   NhÆ°ng Ä‘á»i toÃ n báº«y troll thÃ´i ğŸ˜œ<br>
                   <b>(Dá»«ng á»Ÿ cÃ¢u ${qNum} - Rank: Táº­p Sá»±)</b><br><br>${prize}`;
        } else {
            msg = `Äau cho Ä‘á»™i bÃ¡n cau ğŸ˜­<br>
                   ${name} Ä‘Ã£ tiáº¿n ráº¥t xa rá»“i!<br>
                   <b>(Dá»«ng á»Ÿ cÃ¢u ${qNum} - Rank: Cao Thá»§)</b><br><br>${prize}`;
        }

        this.showEndScreen(title, msg);
    },

    // --- Cáº¬P NHáº¬T LOGIC CHIáº¾N THáº®NG ---
    victory() {
        const { name } = this.user;
        this.showEndScreen(
            "ğŸ† HUYá»€N THOáº I",
            `BÃI PHá»¤C! ğŸ™<br>
             ${name} Ä‘Ã£ phÃ¡ Ä‘áº£o toÃ n bá»™ 15 cÃ¢u há»i hack nÃ£o!<br><br>
             ğŸ˜ˆ <b>GIáº¢I THÆ¯á»NG Äáº¶C BIá»†T:</b><br>
             ğŸ‘‰ <b>Báº¡n Ä‘Æ°á»£c quyá»n yÃªu cáº§u 1 thá»© báº¥t ká»³ vá»›i Chá»§ Game!</b><br>
             (Coi chá»«ng Ä‘Ã²i quÃ¡ Ä‘Ã¡ng lÃ  bá»‹ block Ä‘Ã³ nha ğŸ˜†)`
        );
    },

    showEndScreen(title, msg) {
        document.getElementById('screen-play').classList.add('hidden');
        document.getElementById('screen-start').classList.remove('hidden');
        const startDiv = document.getElementById('screen-start');
        startDiv.innerHTML = `
            <div style="flex-grow:1; display:flex; flex-direction:column; justify-content:center;">
                <h1 style="color:var(--wrong); font-size:2em">${title}</h1>
                <div style="font-size:1.1em; margin:20px; line-height:1.5; color:#ddd">${msg}</div>
                <button class="btn-main" onclick="location.reload()">ChÆ¡i láº¡i</button>
            </div>
            <div class="intro-text">
                Mini game by NCT<br>ChÃºc báº¡n may máº¯n láº§n sau!
            </div>
        `;
    },

    useLife(type) {
        if(!this.lifelines[type]) return;
        const btn = document.getElementById('btn-'+type);
        if(btn.classList.contains('locked')) return;

        this.lifelines[type] = false;
        btn.classList.add('used');
        btn.onclick = null;
        this.isPaused = true;

        const qData = this.questions[this.currentQ];
        const correctChar = String.fromCharCode(65 + qData.c);
        let title = "", content = "";

        switch(type) {
            case '5050':
                this.isPaused = false;
                const wrong = [0,1,2,3].filter(x => x !== qData.c);
                const remove = wrong.sort(()=>Math.random()-.5).slice(0,2);
                document.querySelectorAll('.option').forEach((el, i) => {
                    if(remove.includes(i)) el.classList.add('hidden-50');
                });
                return;
            case 'phone':
                title = "ğŸ“ Gá»ŒI NGÆ¯á»œI THÃ‚N";
                const rd = Math.random();
                if(rd > 0.4) content = `Alo ${this.user.name} Ã ? Bá»‘ vá»«a tra ChatGPT xong, nÃ³ báº£o Ä‘Ã¡p Ã¡n lÃ  <b>${correctChar}</b>. Tin hay khÃ´ng tÃ¹y con!`;
                else content = `TÃºt... tÃºt... ThuÃª bao quÃ½ khÃ¡ch vá»«a gá»i hiá»‡n Ä‘ang báº­n Ä‘i nháº­u, vui lÃ²ng tá»± chá»n bá»«a!`;
                break;
            case 'audience':
                title = "ğŸ‘¥ KHÃN GIáº¢ TRÆ¯á»œNG QUAY";
                content = `98% khÃ¡n giáº£ Ä‘á»u chá»n Ä‘Ã¡p Ã¡n <b>${correctChar}</b>.<br>Há» báº£o ai chá»n khÃ¡c lÃ  "ngÆ°á»i sao Há»a"!`;
                break;
            case 'expert':
                title = "ğŸ§™ Tá»” TÆ¯ Váº¤N Cáº¤P CAO";
                content = `<b>GS. Xoay:</b> "TÃ´i thá» danh dá»± lÃ  <b>${correctChar}</b>."<br><b>TS. Biáº¿t Tuá»‘t:</b> "KhÃ´ng Ä‘Ãºng tÃ´i Ä‘i Ä‘áº§u xuá»‘ng Ä‘áº¥t!"`;
                break;
        }
        this.showOverlay(title, content);
    },

    showOverlay(t, c) {
        const ov = document.getElementById('overlay');
        ov.classList.remove('hidden');
        document.getElementById('ov-title').innerHTML = t;
        document.getElementById('ov-content').innerHTML = c;
    },
    closeOverlay() {
        document.getElementById('overlay').classList.add('hidden');
        this.isPaused = false;
    },
    resetUI() {
        document.querySelectorAll('.life-btn').forEach(b => {
            b.classList.remove('used');
            b.classList.remove('locked');
        });
    }
};
</script>
</body>
</html>

```
