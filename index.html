<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Thá»­ ThÃ¡ch VÃ´ Cá»±c - PhiÃªn Báº£n NCT</title>
<style>
:root{--gold:#ffd700;--neon:#00f3ff;--bg:#050505;--panel:#1a1a1a;--wrong:#ff0044;--right:#00ff88;}
body{margin:0;font-family:'Segoe UI',sans-serif;background:var(--bg);color:#fff;display:flex;justify-content:center;align-items:center;min-height:100vh;overflow:hidden;user-select:none}
.box{width:95%;max-width:600px;background:var(--panel);border:1px solid #333;border-radius:20px;padding:25px;box-shadow:0 0 50px rgba(0,243,255,0.1);position:relative;display:flex;flex-direction:column;min-height:550px}

/* HEADER */
.intro-text{text-align:center;color:#aaa;font-size:0.95em;font-style:italic;margin-bottom:20px;line-height:1.5;border-bottom:1px solid #333;padding-bottom:15px}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;font-weight:bold;color:var(--gold)}

/* LIFELINES */
.lifelines{display:flex;justify-content:space-between;margin-bottom:20px;gap:10px}
.life-btn{flex:1;aspect-ratio:1;background:#222;border:1px solid #444;border-radius:10px;font-size:1.5em;cursor:pointer;transition:.2s;display:flex;align-items:center;justify-content:center;position:relative}
.life-btn:hover:not(.locked):not(.used){background:#333;border-color:var(--neon);color:var(--neon)}
.life-btn.locked{opacity:0.5;cursor:not-allowed;background:#111}
.life-btn.locked::after{content:'ğŸ”’';position:absolute;font-size:0.6em;top:2px;right:2px}
.life-btn.used{opacity:0.3;cursor:default;filter:grayscale(1)}
.life-btn.used::before{content:'âŒ';position:absolute;color:red;font-size:1.5em;z-index:2}

/* GAMEPLAY */
#timer{font-size:3.5em;text-align:center;font-weight:900;color:var(--neon);text-shadow:0 0 20px var(--neon);margin:10px 0;font-family:monospace}
#question{font-size:1.3em;text-align:center;min-height:90px;display:flex;align-items:center;justify-content:center;margin:15px 0;line-height:1.4}
.options-grid{display:grid;gap:10px;margin-top:auto}
.option{padding:15px;background:#2a2a2a;border:1px solid #444;border-radius:10px;cursor:pointer;transition:.2s;font-size:1.1em;position:relative;overflow:hidden}
.option:hover{background:#333;border-color:var(--neon)}
.option.correct{background:var(--right)!important;color:#000;font-weight:bold}
.option.wrong{background:var(--wrong)!important;color:#fff}
.option.hidden-50{opacity:0;pointer-events:none}

/* SCREENS */
.hidden{display:none!important}
.start-screen{text-align:center;padding:10px}
.start-screen h1{color:var(--neon);font-size:2.2em;text-transform:uppercase;margin-bottom:5px;letter-spacing:2px}
.inp-name{width:80%;padding:15px;background:#111;border:2px solid var(--neon);color:#fff;font-size:1.2em;text-align:center;margin:20px 0;border-radius:50px;outline:none}
.btn-main{padding:15px 50px;background:var(--gold);color:#000;font-weight:bold;font-size:1.2em;border:none;border-radius:50px;cursor:pointer;transition:0.3s;text-transform:uppercase}
.btn-main:hover{transform:scale(1.05);box-shadow:0 0 20px var(--gold)}

/* OVERLAY */
#overlay{position:absolute;inset:0;background:rgba(0,0,0,0.95);z-index:100;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:20px;text-align:center;border-radius:20px}
#ov-content{font-size:1.2em;margin:20px 0;line-height:1.6}
.close-btn{padding:10px 30px;background:var(--neon);border:none;border-radius:5px;font-weight:bold;cursor:pointer}

/* ANIMATION */
@keyframes shake{0%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}100%{transform:translateX(0)}}
.shake{animation:shake 0.3s ease-in-out}
</style>
</head>
<body>

<div class="box">
  <div id="screen-start" class="start-screen">
    <div class="intro-text">
        Xin chÃ o Báº¡n yÃªu, hÃ´m nay má»‡t má»i hay nhiá»u niá»m vui?<br>
        ThÆ° giÃ£n, giáº£i trÃ­ 1 chÃºt nhÃ©, hy vá»ng sau khi chÆ¡i báº¡n khÃ´ng cay cÃº ğŸ˜†<br>
        ÄÃ¢y lÃ  mini game cá»§a NCT...
    </div>
    <h1>ThÃ¡nh Troll<br>Äáº¡i Chiáº¿n</h1>
    <p style="color:#666;font-size:0.9em">ğŸ”¥ Cáº£nh bÃ¡o: Tá»« cÃ¢u 7 trá»Ÿ Ä‘i ráº¥t háº¡i nÃ£o!</p>
    <input type="text" id="inp-name" class="inp-name" placeholder="Nháº­p tÃªn vÃ o Ä‘Ã¢y..." autocomplete="off">
    <button class="btn-main" onclick="game.start()">Báº¯t Ä‘áº§u</button>
  </div>

  <div id="screen-play" class="hidden" style="display:flex; flex-direction:column; height:100%">
    <div class="header">
        <span id="player-display">Player</span>
        <span id="level-indicator" style="background:var(--gold);color:#000;padding:2px 10px;border-radius:10px">CÃ‚U 1/15</span>
    </div>

    <div class="lifelines">
        <div class="life-btn" id="btn-5050" onclick="game.useLife('5050')" title="50:50">âš–ï¸</div>
        <div class="life-btn" id="btn-phone" onclick="game.useLife('phone')" title="Gá»i ngÆ°á»i thÃ¢n">ğŸ“</div>
        <div class="life-btn locked" id="btn-audience" onclick="game.useLife('audience')" title="Há»i Ã½ kiáº¿n khÃ¡n giáº£ (Má»Ÿ á»Ÿ cÃ¢u 10)">ğŸ‘¥</div>
        <div class="life-btn locked" id="btn-expert" onclick="game.useLife('expert')" title="Tá»• tÆ° váº¥n (Má»Ÿ á»Ÿ cÃ¢u 14)">ğŸ§™</div>
    </div>

    <div id="timer">15</div>
    <div id="question">Loading...</div>
    <div class="options-grid" id="options"></div>
  </div>
</div>

<div id="overlay" class="hidden">
    <h2 id="ov-title" style="color:var(--gold);margin:0">TITLE</h2>
    <div id="ov-content">Content</div>
    <button class="close-btn" onclick="game.closeOverlay()">ÄÃƒ HIá»‚U</button>
</div>

<script>
/* ================= DATABASE PHÃ‚N LOáº I Äá»˜ KHÃ“ ================= */
// Level 1: Dá»…/Äá»‘ máº¹o vui (DÃ¹ng cho cÃ¢u 1-6)
const DB_EASY = [
    {q:"Con gÃ  cÃ³ trÆ°á»›c hay quáº£ trá»©ng cÃ³ trÆ°á»›c?", o:["GÃ ","Trá»©ng","Cáº£ hai","KhÃ´ng biáº¿t"], c:1},
    {q:"1 kg sáº¯t vÃ  1 kg bÃ´ng, cÃ¡i nÃ o náº·ng hÆ¡n?", o:["Sáº¯t","BÃ´ng","Báº±ng nhau","TÃ¹y loáº¡i"], c:2},
    {q:"ThÃ¡ng nÃ o trong nÄƒm cÃ³ 28 ngÃ y?", o:["ThÃ¡ng 2","ThÃ¡ng Cháº¡p","ThÃ¡ng GiÃªng","Táº¥t cáº£ cÃ¡c thÃ¡ng"], c:3},
    {q:"Máº·t trá»i má»c hÆ°á»›ng nÃ o?", o:["ÄÃ´ng","TÃ¢y","Nam","Báº¯c"], c:0},
    {q:"BÃ¡nh chÆ°ng hÃ¬nh gÃ¬?", o:["TrÃ²n","VuÃ´ng","Tam giÃ¡c","Chá»¯ nháº­t"], c:1},
    {q:"CÃ¡i gÃ¬ tay trÃ¡i cáº§m Ä‘Æ°á»£c cÃ²n tay pháº£i thÃ¬ khÃ´ng?", o:["BÃºt","CÃ¹i chá» trÃ¡i","CÃ¹i chá» pháº£i","Äiá»‡n thoáº¡i"], c:2},
    {q:"Khi báº¯n sÃºng ngÆ°á»i ta nháº¯m máº¥y máº¯t?", o:["1 máº¯t","2 máº¯t","Má»Ÿ háº¿t","Nháº¯m háº¿t"], c:0},
    {q:"Con gÃ¬ Ä‘áº­p thÃ¬ sá»‘ng, khÃ´ng Ä‘áº­p thÃ¬ cháº¿t?", o:["Con cÃ¡","Con tim","Con quay","Con muá»—i"], c:1},
    {q:"SÃ´ng gÃ¬ khÃ´ng cÃ³ nÆ°á»›c?", o:["SÃ´ng Há»“ng","SÃ´ng Tiá»n","SÃ´ng NgÃ¢n HÃ ","SÃ´ng ÄÃ "], c:2},
    {q:"CÃ¡i gÃ¬ cÃ ng cáº¥t láº¡i cÃ ng tháº¥y?", o:["Tiá»n","VÃ ng","CÃ¡t","RÃ¡c"], c:1}, // CÃ¡t (xÃ¢y dá»±ng)
    {q:"Xe nÃ o khÃ´ng bao giá» giáº£m Ä‘i?", o:["Xe Ä‘áº¡p","Xe mÃ¡y","Xe tÄƒng","Xe lu"], c:2}, // Xe tÄƒng (chiáº¿n Ä‘áº¥u/tÄƒng lÃªn)
    {q:"CÃ¡i gÃ¬ ngÆ°á»i mua biáº¿t, ngÆ°á»i bÃ¡n biáº¿t, ngÆ°á»i dÃ¹ng khÃ´ng biáº¿t?", o:["Quan tÃ i","Thuá»‘c","BÃ­ máº­t","VÃ ng"], c:0}
];

// Level 2: KhÃ³/Hack nÃ£o/Logic bá»±a (DÃ¹ng cho cÃ¢u 7-15)
const DB_HARD = [
    {q:"Ba cá»§a Mary cÃ³ 5 con: Nana, Nene, Nini, Nono. NgÆ°á»i thá»© 5 tÃªn gÃ¬?", o:["Nunu","Mary","Mimi","Nina"], c:1},
    {q:"NgÃ y kia cá»§a ngÃ y hÃ´m qua lÃ  ngÃ y gÃ¬ náº¿u hÃ´m nay lÃ  Thá»© Hai?", o:["Thá»© Hai","Thá»© Ba","Chá»§ Nháº­t","Thá»© TÆ°"], c:0},
    {q:"LÃ m sao Ä‘á»ƒ cÃ³ con cua 9 chÃ¢n?", o:["Luá»™c lÃªn","Cáº¯t bá»›t","Gáº¯n thÃªm","TÃ¬m con Ä‘á»™t biáº¿n"], c:0}, // Cua chÃ­n
    {q:"0 chia cho máº¥y thÃ¬ báº±ng 2?", o:["0","1","2","KhÃ´ng sá»‘ nÃ o"], c:3},
    {q:"Äá»‰nh nÃºi cao nháº¥t tháº¿ giá»›i trÆ°á»›c khi Everest Ä‘Æ°á»£c tÃ¬m ra?", o:["K2","Fansipan","Everest","PhÃº SÄ©"], c:2}, // Váº«n lÃ  Everest
    {q:"CÃ¡i gÃ¬ cá»§a báº¡n nhÆ°ng ngÆ°á»i khÃ¡c dÃ¹ng nhiá»u hÆ¡n?", o:["Tiá»n","TÃªn","Vá»£/Chá»“ng","Xe"], c:1},
    {q:"Tá»« nÃ o 100% ngÆ°á»i Viá»‡t phÃ¡t Ã¢m sai?", o:["Sai","ÄÃºng","Lá»—i","Ngá»ng"], c:0},
    {q:"Gia Ä‘Ã¬nh 5 anh trai, má»—i ngÆ°á»i cÃ³ 1 em gÃ¡i. NhÃ  cÃ³ máº¥y ngÆ°á»i con?", o:["6","10","5","11"], c:0},
    {q:"BÃºt + Táº©y = 11k. BÃºt Ä‘áº¯t hÆ¡n Táº©y 10k. GiÃ¡ cÃ¡i Táº©y?", o:["1k","500Ä‘","1.5k","2k"], c:1}, // BÃºt 10.5, Táº©y 0.5
    {q:"Con gÃ¬ Ä‘áº§u dÃª mÃ¬nh á»‘c?", o:["Con dá»‘c","Con quÃ¡i váº­t","Con dÃª","Con á»‘c"], c:0},
    {q:"Má»™t ngÆ°á»i Ä‘i dÆ°á»›i mÆ°a khÃ´ng Ä‘á»™i mÅ©, khÃ´ng Ã´ mÃ  tÃ³c khÃ´ng Æ°á»›t?", o:["Cháº¡y nhanh","Máº·c Ã¡o mÆ°a","Bá»‹ hÃ³i","Äi Ã´ tÃ´"], c:2},
    {q:"Sá»Ÿ thÃº bá»‹ chÃ¡y, con gÃ¬ cháº¡y ra Ä‘áº§u tiÃªn?", o:["Con chim","Con há»•","Con ngÆ°á»i","Con voi"], c:2},
    {q:"CÃ¡i gÃ¬ cÃ ng nhiá»u lá»— cÃ ng nháº¹?", o:["Miáº¿ng xá»‘p","CÃ¡i lÆ°á»›i","Pho mÃ¡t","Cá»¥c bÃ´ng"], c:0},
    {q:"Báº¡n Ä‘ang Ä‘á»©ng thá»© 2, báº¡n vÆ°á»£t qua ngÆ°á»i thá»© 2. Báº¡n Ä‘á»©ng thá»© máº¥y?", o:["Nháº¥t","NhÃ¬","Ba","TÆ°"], c:1},
    {q:"CÃ³ 10 ngÃ³n tay trong 1 cÃ¡i há»™p. ÄÃ³ lÃ  gÃ¬?", o:["Há»™p quÃ ","GÄƒng tay","XÃ¡c Æ°á»›p","ThÃ¹ng rÃ¡c"], c:1},
    {q:"Quáº§n gÃ¬ rá»™ng nháº¥t?", o:["Quáº§n bÃ²","Quáº§n Ä‘áº£o","Quáº§n xÃ£","Quáº§n Ä‘Ã¹i"], c:1},
    {q:"Lá»‹ch nÃ o dÃ i nháº¥t?", o:["Lá»‹ch Váº¡n NiÃªn","Lá»‹ch sá»­","Lá»‹ch treo tÆ°á»ng","Lá»‹ch trÃ¬nh"], c:1}
];

/* ================= GAME LOGIC ================= */
const game = {
    user: { name: "", gender: "báº¡n" },
    currentQ: 0,
    score: 0,
    timer: 15,
    interval: null,
    questions: [],
    lifelines: { '5050': true, 'phone': true, 'audience': true, 'expert': true },
    isPaused: false,

    start() {
        const name = document.getElementById('inp-name').value.trim();
        if (!name) { alert("Nháº­p cÃ¡i tÃªn vÃ o Ä‘i báº¡n Æ¡i, Ä‘á»«ng lÆ°á»i!"); return; }
        
        // 1. PhÃ¢n tÃ­ch tÃªn & giá»›i tÃ­nh Ä‘á»ƒ Troll sau nÃ y
        this.user.name = name;
        this.detectGender(name);

        // 2. Táº¡o bá»™ cÃ¢u há»i thÃ´ng minh (KhÃ´ng trÃ¹ng láº·p)
        this.questions = this.generateSmartPack();

        // 3. Reset tráº¡ng thÃ¡i
        this.currentQ = 0;
        this.lifelines = { '5050': true, 'phone': true, 'audience': true, 'expert': true };
        this.resetUI();

        document.getElementById('screen-start').classList.add('hidden');
        document.getElementById('screen-play').classList.remove('hidden');
        document.getElementById('player-display').innerText = `NgÆ°á»i chÆ¡i: ${this.user.name}`;
        
        this.loadQuestion();
    },

    // Logic: Kiá»ƒm tra localStorage Ä‘á»ƒ láº¥y cÃ¢u chÆ°a chÆ¡i
    generateSmartPack() {
        let played = JSON.parse(localStorage.getItem('nct_played_ids') || '[]');
        
        // HÃ m láº¥y cÃ¢u há»i chÆ°a chÆ¡i
        const getUnused = (pool, count) => {
            let unused = pool.filter(q => !played.includes(q.q));
            // Náº¿u háº¿t cÃ¢u chÆ°a chÆ¡i, thÃ¬ reset (tÃ¡i cháº¿) Ä‘á»ƒ chÆ¡i láº¡i tá»« Ä‘áº§u
            if (unused.length < count) {
                played = []; // XÃ³a lá»‹ch sá»­
                localStorage.setItem('nct_played_ids', '[]');
                unused = pool;
            }
            return unused.sort(() => Math.random() - 0.5).slice(0, count);
        };

        // Láº¥y 6 cÃ¢u Dá»… + 9 cÃ¢u KhÃ³
        const packEasy = getUnused(DB_EASY, 6);
        const packHard = getUnused(DB_HARD, 9);
        
        return [...packEasy, ...packHard];
    },

    detectGender(name) {
        const n = name.toLowerCase();
        const male = ['hÃ¹ng','cÆ°á»ng','nam','tuáº¥n','Ä‘áº¡t','sÆ¡n','trung','dÅ©ng','minh','quang'];
        const female = ['lan','hoa','huá»‡','trang','linh','tháº£o','vy','háº±ng','tuyáº¿t','nhung'];
        
        if (male.some(k => n.includes(k))) this.user.gender = "anh trai";
        else if (female.some(k => n.includes(k))) this.user.gender = "chá»‹ gÃ¡i";
        else this.user.gender = "báº¡n yÃªu";
    },

    loadQuestion() {
        clearInterval(this.interval);
        this.isPaused = false;
        const qData = this.questions[this.currentQ];
        const qNum = this.currentQ + 1;

        // LÆ°u cÃ¢u há»i vÃ o lá»‹ch sá»­ Ä‘Ã£ chÆ¡i
        let played = JSON.parse(localStorage.getItem('nct_played_ids') || '[]');
        if(!played.includes(qData.q)) {
            played.push(qData.q);
            localStorage.setItem('nct_played_ids', JSON.stringify(played));
        }

        // Cáº­p nháº­t UI
        this.timer = 15;
        document.getElementById('timer').innerText = this.timer;
        document.getElementById('level-indicator').innerText = `CÃ‚U ${qNum}/15`;
        document.getElementById('question').innerText = qData.q;
        
        const grid = document.getElementById('options');
        grid.innerHTML = '';
        grid.style.pointerEvents = 'auto';

        qData.o.forEach((opt, idx) => {
            const btn = document.createElement('div');
            btn.className = 'option';
            btn.innerHTML = `<b>${String.fromCharCode(65+idx)}.</b> ${opt}`;
            btn.onclick = () => this.checkAnswer(idx);
            grid.appendChild(btn);
        });

        this.updateLifelineLocks(qNum);

        this.interval = setInterval(() => {
            if(!this.isPaused) {
                this.timer--;
                document.getElementById('timer').innerText = this.timer;
                if(this.timer <= 0) this.gameOver(true);
            }
        }, 1000);
    },

    updateLifelineLocks(qNum) {
        // Lock Audience (Má»Ÿ á»Ÿ cÃ¢u 10)
        const btnAud = document.getElementById('btn-audience');
        if(qNum < 10) {
            btnAud.classList.add('locked');
            btnAud.onclick = () => alert(`ğŸ”’ KhÃ¡n giáº£ chÆ°a Ä‘Æ°á»£c vÃ o sÃ¢n!\nVÆ°á»£t qua cÃ¢u 9 Ä‘á»ƒ má»Ÿ khÃ³a.`);
        } else if (this.lifelines['audience']) {
            btnAud.classList.remove('locked');
            btnAud.onclick = () => this.useLife('audience');
        }

        // Lock Expert (Má»Ÿ á»Ÿ cÃ¢u 14)
        const btnExp = document.getElementById('btn-expert');
        if(qNum < 14) {
            btnExp.classList.add('locked');
            btnExp.onclick = () => alert(`ğŸ”’ Tá»• tÆ° váº¥n Ä‘ang báº­n!\nChá»‰ há»— trá»£ 2 cÃ¢u cuá»‘i cÃ¹ng (Tá»« cÃ¢u 14).`);
        } else if (this.lifelines['expert']) {
            btnExp.classList.remove('locked');
            btnExp.onclick = () => this.useLife('expert');
        }
    },

    checkAnswer(idx) {
        clearInterval(this.interval);
        const qData = this.questions[this.currentQ];
        const opts = document.querySelectorAll('.option');
        document.getElementById('options').style.pointerEvents = 'none';

        if(idx === qData.c) {
            // ÄÃºng
            opts[idx].classList.add('correct');
            setTimeout(() => {
                this.currentQ++;
                if(this.currentQ === 15) this.victory();
                else this.loadQuestion();
            }, 1000);
        } else {
            // Sai
            opts[idx].classList.add('wrong');
            opts[qData.c].classList.add('correct');
            setTimeout(() => this.gameOver(false), 2000);
        }
    },

    // ============= TROLL LOGIC KHI THUA =============
    gameOver(isTimeout) {
        const { name, gender } = this.user;
        const qNum = this.currentQ + 1;
        let title = isTimeout ? "ğŸ¢ Háº¾T GIá»œ Rá»’I" : "âŒ TOANG Rá»’I";
        let msg = "";

        // Táº¡o cÃ¢u troll dá»±a trÃªn thá»i Ä‘iá»ƒm thua
        if (qNum <= 5) {
            msg = `Trá»i Æ¡i ${name} Æ¡i! CÃ¢u dá»… tháº¿ nÃ y mÃ  cÅ©ng sai Ã¡?<br>
                   ${gender} cÃ³ muá»‘n quay vá» há»c láº¡i máº«u giÃ¡o khÃ´ng? ğŸ¤£<br>
                   <b>(Thua táº¡i cÃ¢u ${qNum} - Má»©c: SÆ¡ Sinh)</b>`;
        } else if (qNum <= 10) {
            msg = `Non vÃ  xanh láº¯m ${name} Ã !<br>
                   Äá»‹nh vÆ°á»£t áº£i nhÆ°ng dÃ²ng Ä‘á»i xÃ´ Ä‘áº©y Ä‘Ãºng khÃ´ng?<br>
                   ThÃ´i Ä‘á»«ng cay cÃº nhÃ© ${gender}! ğŸ˜œ<br>
                   <b>(Thua táº¡i cÃ¢u ${qNum} - Má»©c: Táº­p Sá»±)</b>`;
        } else if (qNum < 15) {
            msg = `Äau! QuÃ¡ Ä‘au cho Ä‘á»™i bÃ¡n cau!<br>
                   ${name} Ä‘Ã£ Ä‘i ráº¥t xa nhÆ°ng xui thÃ´i.<br>
                   TÃ­ ná»¯a thÃ¬ thÃ nh huyá»n thoáº¡i rá»“i!<br>
                   <b>(Thua táº¡i cÃ¢u ${qNum} - Má»©c: Cao Thá»§)</b>`;
        }

        this.showEndScreen(title, msg);
    },

    victory() {
        const { name } = this.user;
        this.showEndScreen(
            "ğŸ† HUYá»€N THOáº I", 
            `BÃ¡i phá»¥c! BÃ¡i phá»¥c!<br>
             ${name} chÃ­nh lÃ  bá»™ nÃ£o thiÃªn tÃ i cá»§a tháº¿ ká»· nÃ y.<br>
             Admin xin Ä‘Æ°á»£c nháº­n má»™t láº¡y! ğŸ™`
        );
    },

    showEndScreen(title, msg) {
        document.getElementById('screen-play').classList.add('hidden');
        document.getElementById('screen-start').classList.remove('hidden');
        const startDiv = document.getElementById('screen-start');
        startDiv.innerHTML = `
            <h1 style="color:var(--wrong)">${title}</h1>
            <div style="font-size:1.1em; margin:20px; line-height:1.5; color:#ddd">${msg}</div>
            <button class="btn-main" onclick="location.reload()">ChÆ¡i láº¡i cho Ä‘á»¡ cay</button>
            <div style="margin-top:20px; font-size:0.8em; color:#666">Mini game by NCT</div>
        `;
    },

    // ============= HELPERS =============
    useLife(type) {
        if(!this.lifelines[type]) return;
        const btn = document.getElementById('btn-'+type);
        if(btn.classList.contains('locked')) return;

        this.lifelines[type] = false;
        btn.classList.add('used');
        btn.onclick = null;
        this.isPaused = true;

        const qData = this.questions[this.currentQ];
        const correctChar = String.fromCharCode(65 + qData.c);
        
        let title = "", content = "";

        switch(type) {
            case '5050':
                this.isPaused = false; // 5050 k cáº§n pause
                const wrong = [0,1,2,3].filter(x => x !== qData.c);
                const remove = wrong.sort(()=>Math.random()-.5).slice(0,2);
                document.querySelectorAll('.option').forEach((el, i) => {
                    if(remove.includes(i)) el.classList.add('hidden-50');
                });
                return; // ThoÃ¡t luÃ´n
            case 'phone':
                title = "ğŸ“ Gá»ŒI NGÆ¯á»œI THÃ‚N";
                const rd = Math.random();
                if(rd > 0.3) content = `Alo ${this.user.name} Ã ? Bá»‘ vá»«a tra Google xong, Ä‘Ã¡p Ã¡n lÃ  <b>${correctChar}</b> nhÃ©. Sai bá»‘ chá»‹u!`;
                else content = `TÃºt... tÃºt... ThuÃª bao quÃ½ khÃ¡ch vá»«a gá»i hiá»‡n Ä‘ang ngá»§, vui lÃ²ng tá»± lá»±c cÃ¡nh sinh! (Äen thÃ´i)`;
                break;
            case 'audience':
                title = "ğŸ‘¥ KHÃN GIáº¢ TRÆ¯á»œNG QUAY";
                content = `98% khÃ¡n giáº£ trong trÆ°á»ng quay Ä‘á»u chá»n Ä‘Ã¡p Ã¡n <b>${correctChar}</b>.<br>Há» báº£o ai chá»n khÃ¡c lÃ  "ngÆ°á»i ngoÃ i hÃ nh tinh"!`;
                break;
            case 'expert':
                title = "ğŸ§™ Tá»” TÆ¯ Váº¤N Cáº¤P CAO";
                content = `<b>GS. Xoay:</b> "TÃ´i Ä‘Ã£ nghiÃªn cá»©u váº¥n Ä‘á» nÃ y 30 nÄƒm. Cháº¯c cháº¯n lÃ  <b>${correctChar}</b>."<br><b>TS. Biáº¿t Tuá»‘t:</b> "Äá»“ng Ã½!"`;
                break;
        }
        this.showOverlay(title, content);
    },

    showOverlay(t, c) {
        const ov = document.getElementById('overlay');
        ov.classList.remove('hidden');
        document.getElementById('ov-title').innerHTML = t;
        document.getElementById('ov-content').innerHTML = c;
    },
    closeOverlay() {
        document.getElementById('overlay').classList.add('hidden');
        this.isPaused = false;
    },
    resetUI() {
        document.querySelectorAll('.life-btn').forEach(b => {
            b.classList.remove('used');
            b.classList.remove('locked');
        });
    }
};
</script>
</body>
</html>
