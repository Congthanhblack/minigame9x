<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vua Th·ª≠ Th√°ch - Tr√≠ Tu·ªá Ng∆∞·ª£c</title>
<style>
:root{--gold:#f1c40f;--blue:#3498db;--dark:#0b0c10;--dark-sec:#1f2833;--red:#e74c3c;--green:#2ecc71;--neon:#66fcf1;}
body{margin:0;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:var(--dark);color:#fff;display:flex;justify-content:center;align-items:center;min-height:100vh;overflow:hidden;user-select:none}
.box{width:95%;max-width:600px;background:var(--dark-sec);border:1px solid #45a29e;border-radius:15px;padding:20px;box-shadow:0 0 30px rgba(102,252,241,0.1);position:relative;display:flex;flex-direction:column;min-height:500px}

/* HEADER & INFO */
.header{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #45a29e;padding-bottom:10px;margin-bottom:15px}
.level-badge{background:var(--gold);color:#000;padding:2px 10px;border-radius:10px;font-weight:bold;font-size:0.9em}

/* LIFELINES */
.lifelines{display:flex;justify-content:space-between;margin-bottom:20px;padding:10px;background:#000;border-radius:10px}
.life-wrap{position:relative;width:23%;}
.life-btn{width:100%;aspect-ratio:1;background:#111;border:2px solid #555;color:#fff;border-radius:50%;font-size:1.5em;cursor:pointer;transition:.3s;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
.life-btn:hover:not(.disabled):not(.used){border-color:var(--neon);color:var(--neon);box-shadow:0 0 10px var(--neon)}
.life-btn.used{opacity:0.4;cursor:default;border-color:#333;color:#333}
.life-btn.used::after{content:'‚ùå';position:absolute;color:var(--red);font-size:1.2em}
/* LOCKED STATE */
.life-btn.locked{cursor:not-allowed;background:#222;opacity:0.6}
.life-btn.locked::before{content:'üîí';position:absolute;font-size:0.8em;z-index:2}
.life-btn.locked span{opacity:0.2}
.unlock-hint{position:absolute;bottom:-20px;width:100%;text-align:center;font-size:0.6em;color:var(--gold);opacity:0;transition:0.3s}
.life-wrap:hover .unlock-hint{opacity:1}

/* GAMEPLAY */
#timer{font-size:3em;text-align:center;font-weight:bold;color:var(--neon);text-shadow:0 0 15px var(--neon);margin:10px 0;font-family:monospace}
#question{font-size:1.3em;text-align:center;min-height:80px;font-weight:500;margin:10px 0;display:flex;align-items:center;justify-content:center;line-height:1.4}
.options-grid{display:grid;gap:12px;margin-top:auto}
.option{padding:15px;border:1px solid #45a29e;border-radius:8px;cursor:pointer;transition:.2s;background:rgba(69,162,158,0.1);display:flex;align-items:center;font-size:1.1em}
.option:hover{background:rgba(102,252,241,0.2);transform:translateX(5px)}
.option.correct{background:var(--green)!important;border-color:#fff;color:#000;font-weight:bold;animation:pulse .5s}
.option.wrong{background:var(--red)!important;border-color:#fff;opacity:.9}
.option.hidden-50{visibility:hidden;pointer-events:none}

/* SCREENS */
.hidden{display:none!important}
.start-screen{text-align:center;padding:20px}
.start-screen h1{color:var(--neon);font-size:2.5em;margin-bottom:10px}
.inp-name{width:80%;padding:15px;background:#000;border:2px solid #45a29e;color:#fff;font-size:1.2em;text-align:center;margin:20px 0;border-radius:30px;outline:none}
.btn-start{padding:15px 40px;background:var(--neon);color:#000;font-weight:bold;font-size:1.2em;border:none;border-radius:30px;cursor:pointer;transition:0.3s}
.btn-start:hover{transform:scale(1.05);box-shadow:0 0 20px var(--neon)}

/* OVERLAY */
#overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);z-index:99;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:20px;box-sizing:border-box;text-align:center}
#overlay h3{color:var(--gold);font-size:2em;margin-bottom:20px}
.close-btn{padding:10px 30px;background:var(--blue);border:none;color:#fff;border-radius:5px;cursor:pointer;margin-top:20px}

/* ANIMATION */
@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.02)}100%{transform:scale(1)}}
.blink{animation:blink-anim 1s infinite}
@keyframes blink-anim{0%{opacity:1}50%{opacity:0.5}100%{opacity:1}}
</style>
</head>
<body>

<div class="box">
  <div id="screen-start" class="start-screen">
    <h1>‚ö° ƒê·∫§U TR∆Ø·ªúNG 100 ‚ö°</h1>
    <p>15 C√¢u h·ªèi - 4 Quy·ªÅn tr·ª£ gi√∫p - C√†ng s√¢u c√†ng kh√≥</p>
    <div style="text-align:left; font-size:0.9em; color:#ccc; margin:20px auto; width:80%; background:#111; padding:15px; border-radius:10px;">
        üîí <b>C∆° ch·∫ø Kh√≥a Tr·ª£ Gi√∫p:</b><br>
        ‚Ä¢ C√¢u 1-9: Ch·ªâ c√≥ 2 quy·ªÅn tr·ª£ gi√∫p.<br>
        ‚Ä¢ C√¢u 10: M·ªü kh√≥a quy·ªÅn th·ª© 3.<br>
        ‚Ä¢ C√¢u 14: M·ªü kh√≥a quy·ªÅn cu·ªëi c√πng.<br>
        <i>(ƒê·ª´ng mong ch·ªù s·ª± d·ªÖ d√†ng!)</i>
    </div>
    <input type="text" id="inp-name" class="inp-name" placeholder="Nh·∫≠p t√™n chi·∫øn binh..." onkeypress="handleEnter(event)">
    <button class="btn-start" onclick="game.start()">V√ÄO GAME NGAY</button>
  </div>

  <div id="screen-play" class="hidden" style="display:flex; flex-direction:column; height:100%">
    <div class="header">
        <div>üë§ <span id="player-name">Player</span></div>
        <div class="level-badge" id="level-indicator">C√ÇU 1/15</div>
    </div>

    <div class="lifelines">
        <div class="life-wrap">
            <button class="life-btn" id="btn-5050" onclick="game.life5050()" title="50:50"><span>‚öñÔ∏è</span></button>
        </div>
        <div class="life-wrap">
            <button class="life-btn" id="btn-phone" onclick="game.lifePhone()" title="G·ªçi ng∆∞·ªùi th√¢n"><span>üìû</span></button>
        </div>
        <div class="life-wrap">
            <button class="life-btn locked" id="btn-audience" onclick="game.lifeAudience()"><span>üë•</span></button>
            <div class="unlock-hint">M·ªü ·ªü C√¢u 10</div>
        </div>
        <div class="life-wrap">
            <button class="life-btn locked" id="btn-expert" onclick="game.lifeExpert()"><span>üßô</span></button>
            <div class="unlock-hint">M·ªü ·ªü C√¢u 14</div>
        </div>
    </div>

    <div id="timer">15</div>
    <div id="question">ƒêang t·∫£i c√¢u h·ªèi...</div>
    <div class="options-grid" id="options"></div>
  </div>
</div>

<div id="overlay" class="hidden">
    <h3 id="ov-title"></h3>
    <div id="ov-content" style="font-size:1.2em; line-height:1.6; color:#fff;"></div>
    <button class="close-btn" onclick="game.closeOverlay()">TI·∫æP T·ª§C</button>
</div>

<script>
/* ================== DATABASE C√ÇU H·ªéI (60 C√ÇU M·∫™U ƒêA D·∫†NG) ================== */
/* B·∫°n c√≥ th·ªÉ th√™m c√¢u h·ªèi theo format: {q:"C√¢u h·ªèi", o:["A","B","C","D"], c:V·ªã_tr√≠_ƒë√∫ng(0-3)} */
const DB = [
    // --- C·∫§P ƒê·ªò 1: KH·ªûI ƒê·ªòNG & ƒê·ªê M·∫∏O VUI (D·ªÑ) ---
    {q:"Con g√† c√≥ tr∆∞·ªõc hay qu·∫£ tr·ª©ng c√≥ tr∆∞·ªõc?", o:["Con g√†","Qu·∫£ tr·ª©ng","C·∫£ hai","Kh√¥ng c√≥ c√°i n√†o"], c:1},
    {q:"Th√°ng n√†o trong nƒÉm c√≥ 28 ng√†y?", o:["Th√°ng 2","Th√°ng 12","Th√°ng nhu·∫≠n","T·∫•t c·∫£ c√°c th√°ng"], c:3},
    {q:"C√°i g√¨ tay tr√°i c·∫ßm ƒë∆∞·ª£c m√† tay ph·∫£i kh√¥ng c·∫ßm ƒë∆∞·ª£c?", o:["C√¢y b√∫t","Khu·ª∑u tay tr√°i","C√°i ly","Khu·ª∑u tay ph·∫£i"], c:3},
    {q:"1 kg s·∫Øt v√† 1 kg b√¥ng, c√°i n√†o n·∫∑ng h∆°n?", o:["S·∫Øt","B√¥ng","B·∫±ng nhau","T√πy lo·∫°i s·∫Øt"], c:2},
    {q:"Nh√† Nam c√≥ 4 anh em: Xu√¢n, H·∫°, Thu... Ng∆∞·ªùi c√≤n l·∫°i t√™n g√¨?", o:["ƒê√¥ng","B·∫Øc","Nam","T√¢y"], c:2},
    {q:"Con g√¨ ƒë·∫≠p th√¨ s·ªëng, kh√¥ng ƒë·∫≠p th√¨ ch·∫øt?", o:["Con tim","Con c√°","Con quay","Con l·∫≠t ƒë·∫≠t"], c:0},
    {q:"B√°nh ch∆∞ng h√¨nh g√¨?", o:["H√¨nh tr√≤n","H√¨nh vu√¥ng","H√¨nh ch·ªØ nh·∫≠t","H√¨nh tam gi√°c"], c:1},
    {q:"Khi b·∫Øn s√∫ng ng∆∞·ªùi ta nh·∫Øm m·∫•y m·∫Øt?", o:["1 m·∫Øt","2 m·∫Øt","Kh√¥ng nh·∫Øm","Nh·∫Øm c·∫£ 2"], c:0},
    {q:"M·∫∑t tr·ªùi m·ªçc h∆∞·ªõng n√†o?", o:["ƒê√¥ng","T√¢y","Nam","B·∫Øc"], c:0},
    {q:"C√°i g√¨ c√†ng c·∫•t l·∫°i c√†ng th·∫•y?", o:["Ti·ªÅn","V√†ng","C√°t","R√°c"], c:1}, /* C√°t (x√¢y d·ª±ng) */
    {q:"Con m√®o n√†o c·ª±c k·ª≥ s·ª£ chu·ªôt?", o:["M√®o Tom","M√®o Oggy","Doraemon","M√®o Kitty"], c:2},
    {q:"S√¥ng g√¨ kh√¥ng c√≥ n∆∞·ªõc?", o:["S√¥ng Ti·ªÅn","S√¥ng H·∫≠u","S√¥ng Ng√¢n H√†","S√¥ng H·ªìng"], c:2},
    {q:"C√°i g√¨ ƒëi th√¨ n·∫±m, ƒë·ª©ng th√¨ n·∫±m, nh∆∞ng n·∫±m l·∫°i ƒë·ª©ng?", o:["Con r·∫Øn","B√†n ch√¢n","C√°i b√≥ng","Con s√¢u"], c:1},
    {q:"L√†m sao ƒë·ªÉ kh√¥ng bao gi·ªù bu·ªìn ng·ªß khi th·ª©c tr·∫Øng 7 ng√†y?", o:["U·ªëng cafe","Ng·ªß ƒë√™m","T·∫Øm n∆∞·ªõc l·∫°nh","Nghe nh·∫°c"], c:1},
    {q:"Con cua ƒë·ªè 10cm ch·∫°y ƒëua cua xanh 15cm. Con n√†o v·ªÅ ƒë√≠ch tr∆∞·ªõc?", o:["Cua ƒë·ªè","Cua xanh","B·∫±ng nhau","Kh√¥ng con n√†o"], c:1}, /* Cua ƒë·ªè ƒë√£ lu·ªôc */

    // --- C·∫§P ƒê·ªò 2: KI·∫æN TH·ª®C NG∆Ø·ª¢C & ƒê·ªúI S·ªêNG (TRUNG B√åNH) ---
    {q:"C√°i g√¨ ng∆∞·ªùi mua bi·∫øt, ng∆∞·ªùi b√°n bi·∫øt, ng∆∞·ªùi d√πng kh√¥ng bao gi·ªù bi·∫øt?", o:["Thu·ªëc ƒë·ªôc","Quan t√†i","V√†ng m√£","B√≠ m·∫≠t"], c:1},
    {q:"M√¥n th·ªÉ thao n√†o c√†ng th·∫Øng (phanh) l·∫°i c√†ng thua?", o:["ƒêua xe ƒë·∫°p","ƒêua ng·ª±a","B∆°i l·ªôi","Ch·∫°y ƒëi·ªÅn kinh"], c:0},
    {q:"Lo·∫°i n∆∞·ªõc gi·∫£i kh√°t n√†o ch·ª©a S·∫Øt v√† Canxi?", o:["Coca","Pepsi","Cafe","Sinh t·ªë"], c:2}, /* Ca-Fe */
    {q:"Th·ª£ g√¨ kh√¥ng bao gi·ªù c·∫Øt t√≥c cho kh√°ch?", o:["Th·ª£ may","Th·ª£ m·ªôc","Th·ª£ n·ªÅ","Th·ª£ l·∫∑n"], c:2}, /* Th·ª£ n·ªÅ (x√¢y) */
    {q:"T·ª´ n√†o 100% ng∆∞·ªùi Vi·ªát ƒë·ªÅu ph√°t √¢m sai?", o:["ƒê√∫ng","Sai","Chu·∫©n","L·ªói"], c:1},
    {q:"Qu·∫ßn g√¨ r·ªông nh·∫•t?", o:["Qu·∫ßn ƒë√πi","Qu·∫ßn d√†i","Qu·∫ßn ƒë·∫£o","Qu·∫ßn b√≤"], c:2},
    {q:"·ªû Vi·ªát Nam, R·ªìng bay ·ªü ƒë√¢u v√† ƒë√°p ·ªü ƒë√¢u?", o:["H√† N·ªôi - Qu·∫£ng Ninh","ThƒÉng Long - H·∫° Long","Hu·∫ø - ƒê√† N·∫µng","TP.HCM - V≈©ng T√†u"], c:1},
    {q:"C√°i g√¨ ch·∫∑t kh√¥ng ƒë·ª©t, b·ª©t kh√¥ng r·ªùi, ph∆°i kh√¥ng kh√¥?", o:["D√¢y thun","N∆∞·ªõc","T√≥c","L·ª≠a"], c:1},
    {q:"N·∫øu b·∫°n v∆∞·ª£t qua ng∆∞·ªùi th·ª© 2 trong cu·ªôc ƒëua, b·∫°n ƒë·ª©ng th·ª© m·∫•y?", o:["Th·ª© nh·∫•t","Th·ª© hai","Th·ª© ba","Th·ª© t∆∞"], c:1},
    {q:"S·ªë n√†o tƒÉng l√™n khi b·∫°n l·∫≠t ng∆∞·ª£c n√≥ l·∫°i?", o:["S·ªë 6","S·ªë 9","S·ªë 8","S·ªë 0"], c:0}, /* 6 l·∫≠t th√†nh 9 */
    {q:"Con g√¨ ƒë·∫ßu d√™ m√¨nh ·ªëc?", o:["Con d·ªëc","Con qu√°i v·∫≠t","Con d√™","Con ·ªëc"], c:0},
    {q:"Ki·∫øn n√†o kh√¥ng bao gi·ªù ng·ªß?", o:["Ki·∫øn l·ª≠a","Ki·∫øn ƒëen","Ki·∫øn ba khoang","Ki·∫øn th·ª©c"], c:3},
    {q:"C√°i g√¨ c√≥ c·ªï m√† kh√¥ng c√≥ ƒë·∫ßu?", o:["Con h∆∞∆°u","C√°i √°o","Con r√πa","C√°i gh·∫ø"], c:1},
    {q:"C·∫ßu g√¨ kh√¥ng b·∫Øc qua s√¥ng, kh√¥ng c√≥ xe ch·∫°y?", o:["C·∫ßu Kh·ªâ","C·∫ßu V·ªìng","C·∫ßu M√¢y","C·∫ßu Tre"], c:1},
    {q:"C√≥ 3 qu·∫£ t√°o, b·∫°n l·∫•y 2 qu·∫£. B·∫°n c√≥ bao nhi√™u qu·∫£?", o:["1 qu·∫£","2 qu·∫£","3 qu·∫£","0 qu·∫£"], c:1}, /* B·∫°n l·∫•y th√¨ b·∫°n c√≥ */

    // --- C·∫§P ƒê·ªò 3: HACK N√ÉO & LOGIC (KH√ì) ---
    {q:"Ba c·ªßa Mary c√≥ 5 con: Nana, Nene, Nini, Nono. Ng∆∞·ªùi th·ª© 5 t√™n g√¨?", o:["Nunu","Nina","Mary","Mimi"], c:2},
    {q:"0 chia cho m·∫•y th√¨ b·∫±ng 2?", o:["0","1","2","Kh√¥ng s·ªë n√†o"], c:3},
    {q:"ƒê·ªânh n√∫i cao nh·∫•t th·∫ø gi·ªõi tr∆∞·ªõc khi Everest ƒë∆∞·ª£c kh√°m ph√°?", o:["Fansipan","Ph√∫ Sƒ©","K2","Everest"], c:3},
    {q:"L√†m th·∫ø n√†o ƒë·ªÉ c√≥ con cua 9 ch√¢n?", o:["B·∫Øt con 9 ch√¢n","Lu·ªôc n√≥ l√™n","C·∫Øt b·ªõt ch√¢n","G·∫Øn th√™m ch√¢n"], c:1}, /* Cua ch√≠n */
    {q:"M·ªôt ng∆∞·ªùi ƒëi d∆∞·ªõi m∆∞a kh√¥ng ƒë·ªôi m≈©, kh√¥ng che √¥ m√† t√≥c kh√¥ng ∆∞·ªõt?", o:["Ch·∫°y nhanh","M∆∞a nh·ªè","Ng∆∞·ªùi ƒë√≥ h√≥i","M·∫∑c √°o m∆∞a"], c:2},
    {q:"C√°i g√¨ c·ªßa b·∫°n nh∆∞ng ng∆∞·ªùi kh√°c d√πng nhi·ªÅu h∆°n?", o:["Ti·ªÅn","T√™n","ƒêi·ªán tho·∫°i","Xe"], c:1},
    {q:"Gia ƒë√¨nh c√≥ 5 con trai, m·ªói ng∆∞·ªùi c√≥ 1 em g√°i. Nh√† c√≥ m·∫•y con?", o:["6 ng∆∞·ªùi","10 ng∆∞·ªùi","5 ng∆∞·ªùi","11 ng∆∞·ªùi"], c:0},
    {q:"B√∫t + T·∫©y = 11k. B√∫t ƒë·∫Øt h∆°n T·∫©y 10k. Gi√° c√°i T·∫©y?", o:["1k","500ƒë","1.5k","2k"], c:1}, /* B√∫t 10.5, T·∫©y 0.5 */
    {q:"N·∫øu h√¥m nay l√† Th·ª© Hai, ng√†y kia c·ªßa ng√†y h√¥m qua l√† th·ª© m·∫•y?", o:["Th·ª© Hai","Th·ª© Ba","Th·ª© T∆∞","Ch·ªß Nh·∫≠t"], c:1},
    {q:"C√°i g√¨ c√†ng s·∫°ch c√†ng b·∫©n?", o:["N∆∞·ªõc","Kh√¥ng kh√≠","B·∫£ng ƒëen","T·ªù gi·∫•y"], c:2}, /* Ph·∫•n x√≥a b·∫£ng */
    {q:"Con s·ªë n√†o ch·ªâ tƒÉng kh√¥ng bao gi·ªù gi·∫£m?", o:["C√¢n n·∫∑ng","L∆∞∆°ng","Tu·ªïi t√°c","Gi√° xƒÉng"], c:2},
    {q:"C√≥ 10 ng√≥n tay trong m·ªôt c√°i h·ªôp. ƒê√≥ l√† c√°i g√¨?", o:["H·ªôp qu√†","ƒê√¥i gƒÉng tay","H·ªôp th·ªãt","B√†n tay"], c:1},
    {q:"S·ªü th√∫ b·ªã ch√°y, con g√¨ ch·∫°y ra ƒë·∫ßu ti√™n?", o:["Con chim","Con voi","Con ng∆∞·ªùi","Con h·ªï"], c:2},
    {q:"T·ª´ 'Th·∫ßn ƒê·ªìng' trong ti·∫øng Anh l√† g√¨?", o:["Genius","Smart","Prodigy","God Kid"], c:2},
    {q:"C√°i g√¨ c√†ng nhi·ªÅu l·ªó c√†ng nh·∫π?", o:["Mi·∫øng x·ªëp","C√°i l∆∞·ªõi","Pho m√°t","C·ª•c b√¥ng"], c:0}
];

/* ================== GAME LOGIC ================== */
const game = {
    index: 0, 
    pack: [], 
    timer: 15, 
    interval: null, 
    score: 0,
    lifelines: { '5050': true, 'phone': true, 'audience': true, 'expert': true },
    isPaused: false,
    
    start() {
        const name = document.getElementById('inp-name').value.trim();
        if (!name) { alert("Vui l√≤ng nh·∫≠p t√™n chi·∫øn binh!"); return; }
        
        document.getElementById('player-name').innerText = name;
        document.getElementById('screen-start').classList.add('hidden');
        document.getElementById('screen-play').classList.remove('hidden');
        document.getElementById('screen-play').style.display = 'flex';
        
        // Tr·ªôn v√† l·∫•y ng·∫´u nhi√™n c√¢u h·ªèi (Reset l·∫°i m·ªói l·∫ßn ch∆°i)
        this.pack = [...DB].sort(() => Math.random() - 0.5).slice(0, 15);
        this.index = 0;
        this.lifelines = { '5050': true, 'phone': true, 'audience': true, 'expert': true };
        
        // Reset giao di·ªán tr·ª£ gi√∫p
        document.querySelectorAll('.life-btn').forEach(b => {
            b.classList.remove('used');
            b.classList.remove('locked');
        });
        
        this.loadQuestion();
    },

    loadQuestion() {
        clearInterval(this.interval);
        this.isPaused = false;
        const q = this.pack[this.index];
        const qNum = this.index + 1;
        
        // C·∫≠p nh·∫≠t tr·∫°ng th√°i Tr·ª£ gi√∫p (Logic Kh√≥a)
        this.updateLifelineState(qNum);

        // UI Updates
        this.timer = 15;
        document.getElementById('timer').innerText = this.timer;
        document.getElementById('timer').style.color = 'var(--neon)';
        document.getElementById('level-indicator').innerText = `C√ÇU ${qNum}/15`;
        document.getElementById('question').innerText = q.q;
        
        const box = document.getElementById('options');
        box.innerHTML = '';
        box.style.pointerEvents = 'auto'; // M·ªü kh√≥a click

        q.o.forEach((t, i) => {
            const d = document.createElement('div');
            d.className = 'option';
            d.innerHTML = `<b style="color:var(--gold);margin-right:15px">${String.fromCharCode(65 + i)}.</b> ${t}`;
            d.onclick = () => this.check(i);
            box.appendChild(d);
        });

        // Ch·∫°y ƒë·ªìng h·ªì
        this.interval = setInterval(() => {
            if (!this.isPaused) {
                this.timer--;
                document.getElementById('timer').innerText = this.timer;
                if (this.timer <= 5) document.getElementById('timer').style.color = 'var(--red)';
                if (this.timer <= 0) this.lose(true);
            }
        }, 1000);
    },

    // --- LOGIC KH√ìA TR·ª¢ GI√öP ---
    updateLifelineState(currentQ) {
        // Audience: M·ªü kh√≥a ·ªü c√¢u 10 (t·ª©c l√† index 9)
        const btnAud = document.getElementById('btn-audience');
        if (currentQ < 10) {
            btnAud.classList.add('locked');
            btnAud.onclick = () => this.showOverlay("üîí B·ªä KH√ìA", "Kh√°n gi·∫£ ch∆∞a ƒë∆∞·ª£c ph√©p v√†o tr∆∞·ªùng quay.<br>V∆∞·ª£t qua <b>C√¢u 9</b> ƒë·ªÉ m·ªü kh√≥a!");
        } else {
            if (this.lifelines['audience']) {
                btnAud.classList.remove('locked');
                btnAud.onclick = () => this.lifeAudience();
            }
        }

        // Expert: M·ªü kh√≥a ·ªü c√¢u 14 (t·ª©c l√† index 13)
        const btnExp = document.getElementById('btn-expert');
        if (currentQ < 14) {
            btnExp.classList.add('locked');
            btnExp.onclick = () => this.showOverlay("üîí B·ªä KH√ìA", "T·ªï t∆∞ v·∫•n ƒëang ƒëi v·∫Øng.<br>V∆∞·ª£t qua <b>C√¢u 13</b> ƒë·ªÉ tri·ªáu h·ªìi h·ªç!");
        } else {
            if (this.lifelines['expert']) {
                btnExp.classList.remove('locked');
                btnExp.onclick = () => this.lifeExpert();
            }
        }
    },

    // --- C√ÅC QUY·ªÄN TR·ª¢ GI√öP ---
    life5050() {
        if (!this.lifelines['5050']) return;
        this.markUsed('btn-5050', '5050');
        const q = this.pack[this.index];
        const wrongIndices = [0, 1, 2, 3].filter(i => i !== q.c);
        // L·∫•y 2 sai ng·∫´u nhi√™n
        const toHide = wrongIndices.sort(() => Math.random() - 0.5).slice(0, 2);
        const opts = document.querySelectorAll('.option');
        toHide.forEach(i => opts[i].classList.add('hidden-50'));
    },
    
    lifePhone() {
        if (!this.lifelines['phone']) return;
        this.markUsed('btn-phone', 'phone');
        this.isPaused = true;
        const q = this.pack[this.index];
        const ans = String.fromCharCode(65 + q.c);
        // T·ªâ l·ªá ƒë√∫ng cao nh∆∞ng v·∫´n c√≥ th·ªÉ sai (90%)
        const isCorrect = Math.random() > 0.1;
        const finalAns = isCorrect ? ans : String.fromCharCode(65 + ([0,1,2,3].filter(i=>i!==q.c)[0]));
        
        this.showOverlay("üìû G·ªåI NG∆Ø·ªúI TH√ÇN", 
            `"Alo con √†? B·ªë ƒëang b·∫≠n nh·∫≠u nh∆∞ng tra Google th√¨ n√≥ b·∫£o l√† ƒë√°p √°n <b>${finalAns}</b> nh√©. Tin b·ªë ƒëi!"`);
    },

    lifeAudience() {
        if (!this.lifelines['audience']) return; // ƒê√£ check lock ·ªü updateLifelineState
        this.markUsed('btn-audience', 'audience');
        this.isPaused = true;
        const q = this.pack[this.index];
        
        // T·∫°o bi·ªÉu ƒë·ªì ·∫£o
        let stats = [0,0,0,0];
        stats[q.c] = Math.floor(Math.random() * 20) + 60; // ƒê√∫ng 60-80%
        let remain = 100 - stats[q.c];
        for(let i=0; i<4; i++) {
            if(i !== q.c) {
                let v = Math.floor(Math.random() * remain);
                stats[i] = v; remain -= v;
            }
        }
        // C·ªông ph·∫ßn d∆∞ v√†o th·∫±ng sai cu·ªëi
        stats[stats.findIndex((v,i)=>i!==q.c && v===0) || (q.c===0?1:0)] += remain;

        let chart = `<div style="display:flex; justify-content:center; align-items:flex-end; gap:15px; height:150px; margin-top:20px">`;
        stats.forEach((v, i) => {
            chart += `<div style="width:30px; display:flex; flex-direction:column; align-items:center;">
                <div style="font-size:0.8em; margin-bottom:5px">${v}%</div>
                <div style="width:100%; height:${v*1.5}px; background:${i===q.c?'var(--green)':'#555'}; transition:1s"></div>
                <div style="font-weight:bold; margin-top:5px">${String.fromCharCode(65+i)}</div>
            </div>`;
        });
        chart += `</div>`;
        
        this.showOverlay("üë• KH√ÅN GI·∫¢ TR∆Ø·ªúNG QUAY", `K·∫øt qu·∫£ b√¨nh ch·ªçn:<br>${chart}`);
    },

    lifeExpert() {
        if (!this.lifelines['expert']) return;
        this.markUsed('btn-expert', 'expert');
        this.isPaused = true;
        const q = this.pack[this.index];
        const ans = String.fromCharCode(65 + q.c);
        this.showOverlay("üßô T·ªî T∆Ø V·∫§N T·∫†I CH·ªñ", 
            `<b>GS. Bi·∫øt Tu·ªët:</b> "C√¢u n√†y thu·ªôc lƒ©nh v·ª±c t√¥i nghi√™n c·ª©u 20 nƒÉm nay. Ch·∫Øc ch·∫Øn l√† <b>${ans}</b>."<br><br>
             <b>TS. Xoay:</b> "T√¥i ƒë·ªìng √Ω ho√†n to√†n!"`);
    },

    markUsed(id, key) {
        document.getElementById(id).classList.add('used');
        document.getElementById(id).onclick = null; // Disable click
        this.lifelines[key] = false;
    },

    // --- X·ª¨ L√ù K·∫æT QU·∫¢ ---
    check(i) {
        clearInterval(this.interval);
        const q = this.pack[this.index];
        const opts = document.querySelectorAll('.option');
        document.getElementById('options').style.pointerEvents = 'none'; // Kh√≥a click

        if (i === q.c) {
            // ƒê√öNG
            opts[i].classList.add('correct');
            setTimeout(() => {
                this.index++;
                if (this.index === 15) this.win();
                else this.loadQuestion();
            }, 1200);
        } else {
            // SAI
            opts[i].classList.add('wrong');
            opts[q.c].classList.add('correct');
            setTimeout(() => this.lose(false), 2000);
        }
    },

    lose(isTimeout) {
        const title = isTimeout ? "‚åõ H·∫æT GI·ªú" : "‚ùå SAI R·ªíI";
        const msg = `B·∫°n ƒë√£ d·ª´ng ch√¢n t·∫°i c√¢u s·ªë <b>${this.index + 1}</b>.<br>ƒê·ª´ng bu·ªìn, ki·∫øn th·ª©c l√† v√¥ t·∫≠n!`;
        this.showEndGame(title, msg);
    },

    win() {
        this.showEndGame("üëë HUY·ªÄN THO·∫†I", "CH√öC M·ª™NG!<br>B·∫°n ƒë√£ tr·∫£ l·ªùi ƒë√∫ng t·∫•t c·∫£ 15 c√¢u h·ªèi.<br>B·∫°n ch√≠nh l√† Vua Ki·∫øn Th·ª©c!");
    },

    showEndGame(title, msg) {
        document.getElementById('screen-play').classList.add('hidden');
        document.getElementById('screen-start').classList.remove('hidden');
        document.querySelector('#screen-start h1').innerHTML = title;
        document.querySelector('#screen-start p').innerHTML = msg;
        document.querySelector('.btn-start').innerText = "CH∆†I L·∫†I";
    },

    showOverlay(title, content) {
        const ov = document.getElementById('overlay');
        ov.classList.remove('hidden');
        document.getElementById('ov-title').innerHTML = title;
        document.getElementById('ov-content').innerHTML = content;
    },
    
    closeOverlay() {
        document.getElementById('overlay').classList.add('hidden');
        this.isPaused = false;
    }
};

function handleEnter(e) { if(e.key === 'Enter') game.start(); }
</script>
</body>
</html>
