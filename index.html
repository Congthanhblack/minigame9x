<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Th·ª≠ Th√°ch V√¥ C·ª±c - Phi√™n B·∫£n NCT</title>
<style>
:root{--gold:#ffd700;--neon:#00f3ff;--bg:#050505;--panel:#1a1a1a;--wrong:#ff0044;--right:#00ff88;}
body{margin:0;font-family:'Segoe UI',sans-serif;background:var(--bg);color:#fff;display:flex;justify-content:center;align-items:center;min-height:100vh;overflow:hidden;user-select:none}
.box{width:95%;max-width:600px;background:var(--panel);border:1px solid #333;border-radius:20px;padding:25px;box-shadow:0 0 50px rgba(0,243,255,0.1);position:relative;display:flex;flex-direction:column;min-height:600px}

/* HEADER & FOOTER */
.intro-text{text-align:center;color:#888;font-size:0.9em;font-style:italic;margin-top:30px;line-height:1.6;border-top:1px solid #333;padding-top:15px}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;font-weight:bold;color:var(--gold)}

/* LIFELINES */
.lifelines{display:flex;justify-content:space-between;margin-bottom:20px;gap:10px}
.life-btn{flex:1;aspect-ratio:1;background:#222;border:1px solid #444;border-radius:10px;font-size:1.5em;cursor:pointer;transition:.2s;display:flex;align-items:center;justify-content:center;position:relative}
.life-btn:hover:not(.locked):not(.used){background:#333;border-color:var(--neon);color:var(--neon)}
.life-btn.locked{opacity:0.5;cursor:not-allowed;background:#111}
.life-btn.locked::after{content:'üîí';position:absolute;font-size:0.6em;top:2px;right:2px}
.life-btn.used{opacity:0.3;cursor:default;filter:grayscale(1)}
.life-btn.used::before{content:'‚ùå';position:absolute;color:red;font-size:1.5em;z-index:2}

/* GAMEPLAY */
#timer{font-size:3.5em;text-align:center;font-weight:900;color:var(--neon);text-shadow:0 0 20px var(--neon);margin:5px 0;font-family:monospace}
#question{font-size:1.25em;text-align:center;min-height:90px;display:flex;align-items:center;justify-content:center;margin:15px 0;line-height:1.4;font-weight:500}
.options-grid{display:grid;gap:10px;margin-top:auto}
.option{padding:15px;background:#2a2a2a;border:1px solid #444;border-radius:10px;cursor:pointer;transition:.2s;font-size:1.05em;position:relative;overflow:hidden; display:flex; align-items:center;}
.option:hover{background:#333;border-color:var(--neon)}
.option.correct{background:var(--right)!important;color:#000;font-weight:bold}
.option.wrong{background:var(--wrong)!important;color:#fff}
.option.hidden-50{opacity:0;pointer-events:none}

/* SCREENS */
.hidden{display:none!important}
.start-screen{text-align:center;padding:10px; display:flex; flex-direction:column; justify-content:center; height:100%;}
.start-screen h1{color:var(--neon);font-size:2.5em;text-transform:uppercase;margin-bottom:10px;letter-spacing:2px; text-shadow: 0 0 10px rgba(0,243,255,0.5);}
.start-screen p {margin-bottom: 30px;}
.inp-name{width:80%;padding:15px;background:#111;border:2px solid var(--neon);color:#fff;font-size:1.2em;text-align:center;margin:0 auto 20px auto;border-radius:50px;outline:none}
.btn-main{padding:15px 50px;background:var(--gold);color:#000;font-weight:bold;font-size:1.2em;border:none;border-radius:50px;cursor:pointer;transition:0.3s;text-transform:uppercase; width: fit-content; margin: 0 auto;}
.btn-main:hover{transform:scale(1.05);box-shadow:0 0 20px var(--gold)}

/* OVERLAY */
#overlay{position:absolute;inset:0;background:rgba(0,0,0,0.95);z-index:100;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:20px;text-align:center;border-radius:20px}
#ov-content{font-size:1.2em;margin:20px 0;line-height:1.6}
.close-btn{padding:10px 30px;background:var(--neon);border:none;border-radius:5px;font-weight:bold;cursor:pointer}

</style>
</head>
<body>

<div class="box">
  <div id="screen-start" class="start-screen">
    <div style="flex-grow:1; display:flex; flex-direction:column; justify-content:center;">
        <h1>Th√°nh Troll<br>ƒê·∫°i Chi·∫øn</h1>
        <p style="color:#666;font-size:0.9em">üî• C·∫£nh b√°o: ƒê√°p √°n c·ª±c k·ª≥ l∆∞∆°n l·∫πo!</p>
        <input type="text" id="inp-name" class="inp-name" placeholder="Nh·∫≠p danh t√≠nh v√†o ƒë√¢y..." autocomplete="off">
        <button class="btn-main" onclick="game.start()">B·∫Øt ƒë·∫ßu</button>
    </div>
    
    <div class="intro-text">
        Xin ch√†o B·∫°n y√™u, h√¥m nay m·ªát m·ªèi hay nhi·ªÅu ni·ªÅm vui?<br>
        Th∆∞ gi√£n, gi·∫£i tr√≠ 1 ch√∫t nh√©, hy v·ªçng sau khi ch∆°i b·∫°n kh√¥ng cay c√∫ üòÜ<br>
        ƒê√¢y l√† mini game c·ªßa NCT...
    </div>
  </div>

  <div id="screen-play" class="hidden" style="display:flex; flex-direction:column; height:100%">
    <div class="header">
        <span id="player-display">Player</span>
        <span id="level-indicator" style="background:var(--gold);color:#000;padding:2px 10px;border-radius:10px">C√ÇU 1/15</span>
    </div>

    <div class="lifelines">
        <div class="life-btn" id="btn-5050" onclick="game.useLife('5050')" title="50:50">‚öñÔ∏è</div>
        <div class="life-btn" id="btn-phone" onclick="game.useLife('phone')" title="G·ªçi ng∆∞·ªùi th√¢n">üìû</div>
        <div class="life-btn locked" id="btn-audience" onclick="game.useLife('audience')" title="H·ªèi √Ω ki·∫øn kh√°n gi·∫£ (M·ªü ·ªü c√¢u 10)">üë•</div>
        <div class="life-btn locked" id="btn-expert" onclick="game.useLife('expert')" title="T·ªï t∆∞ v·∫•n (M·ªü ·ªü c√¢u 14)">üßô</div>
    </div>

    <div id="timer">15</div>
    <div id="question">Loading...</div>
    <div class="options-grid" id="options"></div>
  </div>
</div>

<div id="overlay" class="hidden">
    <h2 id="ov-title" style="color:var(--gold);margin:0">TITLE</h2>
    <div id="ov-content">Content</div>
    <button class="close-btn" onclick="game.closeOverlay()">ƒê√É HI·ªÇU</button>
</div>

<script>
/* ================= DATABASE ƒê√É N√ÇNG C·∫§P (ƒê√ÅP √ÅN G√ÇY NHI·ªÑU) ================= */
// Level 1: D·ªÖ nh∆∞ng ƒë√°p √°n nhi·ªÖu (C√¢u 1-6)
const DB_EASY = [
    {q:"1 kg s·∫Øt v√† 1 kg b√¥ng, c√°i n√†o n·∫∑ng h∆°n?", o:["S·∫Øt (Tr·ªçng l∆∞·ª£ng ri√™ng l·ªõn h∆°n)","B√¥ng (Th·ªÉ t√≠ch l·ªõn h∆°n)","B·∫±ng nhau (ƒê·ªÅu l√† 1kg)","T√πy v√†o l·ª±c h√∫t Tr√°i ƒê·∫•t"], c:2},
    {q:"Th√°ng n√†o trong nƒÉm c√≥ 28 ng√†y?", o:["Ch·ªâ c√≥ Th√°ng 2","Th√°ng 2 (NƒÉm kh√¥ng nhu·∫≠n)","T·∫•t c·∫£ c√°c th√°ng","Th√°ng 2 v√† c√°c th√°ng ch·∫µn"], c:2},
    {q:"M·∫∑t tr·ªùi m·ªçc h∆∞·ªõng ƒê√¥ng, l·∫∑n h∆∞·ªõng T√¢y. V·∫≠y sao Kim m·ªçc h∆∞·ªõng n√†o?", o:["H∆∞·ªõng ƒê√¥ng","H∆∞·ªõng T√¢y","H∆∞·ªõng Nam","H∆∞·ªõng B·∫Øc"], c:1}, // Sao Kim quay ng∆∞·ª£c chi·ªÅu
    {q:"B√°nh ch∆∞ng h√¨nh g√¨?", o:["H√¨nh vu√¥ng (T∆∞·ª£ng tr∆∞ng ƒê·∫•t)","H√¨nh h·ªôp ch·ªØ nh·∫≠t","H√¨nh l·∫≠p ph∆∞∆°ng","H√¨nh tr√≤n (T∆∞·ª£ng tr∆∞ng Tr·ªùi)"], c:0}, // Th·ª±c t·∫ø l√† vu√¥ng
    {q:"C√°i g√¨ tay tr√°i c·∫ßm ƒë∆∞·ª£c c√≤n tay ph·∫£i th√¨ kh√¥ng?", o:["Khu·ª∑u tay tr√°i","Khu·ª∑u tay ph·∫£i","C·ªï tay tr√°i","L√≤ng b√†n tay tr√°i"], c:1},
    {q:"Khi b·∫Øn s√∫ng ng∆∞·ªùi ta nh·∫Øm m·∫Øt n√†o?", o:["M·∫Øt tr√°i","M·∫Øt ph·∫£i","Nh·∫Øm m·ªôt m·∫Øt (b·∫•t k·ª≥)","M·ªü c·∫£ 2 ƒë·ªÉ quan s√°t"], c:2},
    {q:"Con g√¨ ƒë·∫≠p th√¨ s·ªëng, kh√¥ng ƒë·∫≠p th√¨ ch·∫øt?", o:["Con quay (Beyblade)","Con tim","Con c√° ƒëang b∆°i","Con l·∫≠t ƒë·∫≠t"], c:1},
    {q:"S√¥ng g√¨ kh√¥ng c√≥ n∆∞·ªõc?", o:["S√¥ng H·ªìng (M√πa c·∫°n)","S√¥ng Ng√¢n H√†","S√¥ng C·ª≠u Long","S√¥ng Ti·ªÅn"], c:1},
    {q:"Xe n√†o kh√¥ng bao gi·ªù gi·∫£m ƒëi?", o:["Xe kh√°ch","Xe bu√Ωt","Xe tƒÉng (TƒÉng l√™n)","Xe ƒë·∫°p"], c:2}, 
    {q:"C√°i g√¨ ng∆∞·ªùi mua bi·∫øt, ng∆∞·ªùi b√°n bi·∫øt, ng∆∞·ªùi d√πng kh√¥ng bao gi·ªù nh√¨n th·∫•y?", o:["B√≠ m·∫≠t qu·ªëc gia","H·ªôp ƒëen m√°y bay","Quan t√†i","L∆∞∆°ng c·ªßa v·ª£"], c:2}
];

// Level 2: Hack n√£o & ƒê√°p √°n b·∫´y c·ª±c m·∫°nh (C√¢u 7-15)
const DB_HARD = [
    {q:"Ba c·ªßa Mary c√≥ 5 con: Nana, Nene, Nini, Nono. Ng∆∞·ªùi th·ª© 5 t√™n g√¨?", o:["Nunu (Theo quy lu·∫≠t)","Nina (T√™n ph·ªï bi·∫øn)","Mary","Ba c·ªßa Mary"], c:2},
    {q:"N·∫øu h√¥m nay l√† Th·ª© Hai, th√¨ ng√†y mai c·ªßa ng√†y h√¥m qua l√† ng√†y g√¨?", o:["Th·ª© Hai","Th·ª© Ba","Ch·ªß Nh·∫≠t","Th·ª© T∆∞"], c:0},
    {q:"L√†m sao ƒë·ªÉ c√≥ con cua 9 ch√¢n?", o:["T√¨m con ƒë·ªôt bi·∫øn gen","Lu·ªôc n√≥ l√™n (Ch√≠n ch√¢n)","C·∫Øt b·ªõt 1 ch√¢n","G·∫Øn th√™m ch√¢n gi·∫£"], c:1},
    {q:"0 chia cho m·∫•y th√¨ b·∫±ng 2?", o:["0","2","1","Kh√¥ng c√≥ s·ªë n√†o"], c:3},
    {q:"ƒê·ªânh n√∫i cao nh·∫•t th·∫ø gi·ªõi tr∆∞·ªõc khi Everest ƒë∆∞·ª£c t√¨m ra?", o:["ƒê·ªânh K2 (Cao th·ª© 2)","ƒê·ªânh Kangchenjunga","V·∫´n l√† Everest","Ch∆∞a c√≥ ƒë·ªânh n√†o"], c:2},
    {q:"T·ª´ n√†o 100% ng∆∞·ªùi Vi·ªát ph√°t √¢m sai?", o:["T·ª´ 'Sai'","T·ª´ 'Nghi√™ng'","T·ª´ 'Ng·ªçng'","T·ª´ 'L·ªói'"], c:0},
    {q:"Gia ƒë√¨nh 5 anh trai, m·ªói ng∆∞·ªùi c√≥ 1 em g√°i. Nh√† c√≥ m·∫•y ng∆∞·ªùi con?", o:["6 ng∆∞·ªùi","10 ng∆∞·ªùi (5 trai 5 g√°i)","11 ng∆∞·ªùi","5 ng∆∞·ªùi"], c:0},
    {q:"B√∫t + T·∫©y = 11k. B√∫t ƒë·∫Øt h∆°n T·∫©y 10k. Gi√° c√°i T·∫©y?", o:["1k (11-10=1)","500ƒë","1.5k","2k"], c:1}, // B√∫t 10.5, T·∫©y 0.5
    {q:"M·ªôt ng∆∞·ªùi ƒëi d∆∞·ªõi m∆∞a kh√¥ng ƒë·ªôi m≈©, kh√¥ng √¥ m√† t√≥c kh√¥ng ∆∞·ªõt?", o:["Do ƒëi qu√° nhanh","Do m·∫∑c √°o m∆∞a tr√πm ƒë·∫ßu","Do ng∆∞·ªùi ƒë√≥ b·ªã h√≥i","Do tr·ªùi m∆∞a b√≥ng m√¢y"], c:2},
    {q:"S·ªü th√∫ b·ªã ch√°y, con g√¨ ch·∫°y ra ƒë·∫ßu ti√™n?", o:["Con Voi (To nh·∫•t)","Con B√°o (Nhanh nh·∫•t)","Con Ng∆∞·ªùi","Con Chim (Bay ra)"], c:2},
    {q:"B·∫°n ƒëang ƒë·ª©ng th·ª© 2, b·∫°n v∆∞·ª£t qua ng∆∞·ªùi th·ª© 2. B·∫°n ƒë·ª©ng th·ª© m·∫•y?", o:["Th·ª© Nh·∫•t (V√¥ ƒë·ªãch)","Th·ª© Hai","Th·ª© Ba","Th·ª© T∆∞"], c:1},
    {q:"C√≥ 10 ng√≥n tay trong 1 c√°i h·ªôp. ƒê√≥ l√† g√¨?", o:["H·ªôp ƒë·ª±ng ng√≥n tay gi·∫£","ƒê√¥i gƒÉng tay","M·ªôt v·ª• √°n m·∫°ng","H·ªôp qu√† b√≠ ·∫©n"], c:1},
    {q:"Th√°ng n√†o ng·∫Øn nh·∫•t trong nƒÉm?", o:["Th√°ng 2 (√çt ng√†y nh·∫•t)","Th√°ng 5 (T√™n ng·∫Øn nh·∫•t)","Th√°ng Ba (Ba ng√£ T∆∞)","Th√°ng T∆∞"], c:2}, // "Ba" ch·ªâ c√≥ 2 ch·ªØ c√°i
    {q:"C√°i g√¨ thu·ªôc v·ªÅ b·∫°n nh∆∞ng ng∆∞·ªùi kh√°c d√πng nhi·ªÅu h∆°n?", o:["Ti·ªÅn b·∫°c","T√™n c·ªßa b·∫°n","ƒêi·ªán tho·∫°i","Th·ªùi gian"], c:1}
];

/* ================= GAME LOGIC ================= */
const game = {
    user: { name: "", gender: "b·∫°n" },
    currentQ: 0,
    questions: [],
    lifelines: { '5050': true, 'phone': true, 'audience': true, 'expert': true },
    isPaused: false,
    timer: 15,
    interval: null,

    start() {
        const name = document.getElementById('inp-name').value.trim();
        if (!name) { alert("Nh·∫≠p c√°i t√™n v√†o ƒëi b·∫°n ∆°i, ƒë·ª´ng l∆∞·ªùi!"); return; }
        
        this.user.name = name;
        this.detectGender(name);
        this.questions = this.generateSmartPack();
        this.currentQ = 0;
        this.lifelines = { '5050': true, 'phone': true, 'audience': true, 'expert': true };
        this.resetUI();

        document.getElementById('screen-start').classList.add('hidden');
        document.getElementById('screen-play').classList.remove('hidden');
        document.getElementById('player-display').innerText = `Ng∆∞·ªùi ch∆°i: ${this.user.name}`;
        
        this.loadQuestion();
    },

    generateSmartPack() {
        let played = JSON.parse(localStorage.getItem('nct_played_ids') || '[]');
        
        const getUnused = (pool, count) => {
            let unused = pool.filter(q => !played.includes(q.q));
            if (unused.length < count) {
                played = []; 
                localStorage.setItem('nct_played_ids', '[]');
                unused = pool;
            }
            return unused.sort(() => Math.random() - 0.5).slice(0, count);
        };

        return [...getUnused(DB_EASY, 6), ...getUnused(DB_HARD, 9)];
    },

    detectGender(name) {
        const n = name.toLowerCase();
        const male = ['h√πng','c∆∞·ªùng','nam','tu·∫•n','ƒë·∫°t','s∆°n','trung','d≈©ng','minh','quang','kh√°nh','duy'];
        const female = ['lan','hoa','hu·ªá','trang','linh','th·∫£o','vy','h·∫±ng','tuy·∫øt','nhung','ph∆∞∆°ng','h√†'];
        
        if (male.some(k => n.includes(k))) this.user.gender = "anh trai";
        else if (female.some(k => n.includes(k))) this.user.gender = "ch·ªã g√°i";
        else this.user.gender = "b·∫°n y√™u";
    },

    loadQuestion() {
        clearInterval(this.interval);
        this.isPaused = false;
        const qData = this.questions[this.currentQ];
        const qNum = this.currentQ + 1;

        let played = JSON.parse(localStorage.getItem('nct_played_ids') || '[]');
        if(!played.includes(qData.q)) {
            played.push(qData.q);
            localStorage.setItem('nct_played_ids', JSON.stringify(played));
        }

        this.timer = 15;
        document.getElementById('timer').innerText = this.timer;
        document.getElementById('level-indicator').innerText = `C√ÇU ${qNum}/15`;
        document.getElementById('question').innerText = qData.q;
        
        const grid = document.getElementById('options');
        grid.innerHTML = '';
        grid.style.pointerEvents = 'auto';

        qData.o.forEach((opt, idx) => {
            const btn = document.createElement('div');
            btn.className = 'option';
            btn.innerHTML = `<b style="color:var(--gold);margin-right:10px">${String.fromCharCode(65+idx)}.</b> ${opt}`;
            btn.onclick = () => this.checkAnswer(idx);
            grid.appendChild(btn);
        });

        this.updateLifelineLocks(qNum);

        this.interval = setInterval(() => {
            if(!this.isPaused) {
                this.timer--;
                document.getElementById('timer').innerText = this.timer;
                if(this.timer <= 0) this.gameOver(true);
            }
        }, 1000);
    },

    updateLifelineLocks(qNum) {
        const btnAud = document.getElementById('btn-audience');
        if(qNum < 10) {
            btnAud.classList.add('locked');
            btnAud.onclick = () => alert(`üîí Kh√°n gi·∫£ ch∆∞a ƒë∆∞·ª£c v√†o s√¢n!\nV∆∞·ª£t qua c√¢u 9 ƒë·ªÉ m·ªü kh√≥a.`);
        } else if (this.lifelines['audience']) {
            btnAud.classList.remove('locked');
            btnAud.onclick = () => this.useLife('audience');
        }

        const btnExp = document.getElementById('btn-expert');
        if(qNum < 14) {
            btnExp.classList.add('locked');
            btnExp.onclick = () => alert(`üîí T·ªï t∆∞ v·∫•n ƒëang b·∫≠n!\nCh·ªâ h·ªó tr·ª£ 2 c√¢u cu·ªëi c√πng (T·ª´ c√¢u 14).`);
        } else if (this.lifelines['expert']) {
            btnExp.classList.remove('locked');
            btnExp.onclick = () => this.useLife('expert');
        }
    },

    checkAnswer(idx) {
        clearInterval(this.interval);
        const qData = this.questions[this.currentQ];
        const opts = document.querySelectorAll('.option');
        document.getElementById('options').style.pointerEvents = 'none';

        if(idx === qData.c) {
            opts[idx].classList.add('correct');
            setTimeout(() => {
                this.currentQ++;
                if(this.currentQ === 15) this.victory();
                else this.loadQuestion();
            }, 1000);
        } else {
            opts[idx].classList.add('wrong');
            opts[qData.c].classList.add('correct');
            setTimeout(() => this.gameOver(false), 2000);
        }
    },

    gameOver(isTimeout) {
        const { name, gender } = this.user;
        const qNum = this.currentQ + 1;
        let title = isTimeout ? "üê¢ H·∫æT GI·ªú R·ªíI" : "‚ùå TOANG R·ªíI";
        let msg = "";

        if (qNum <= 5) {
            msg = `Tr·ªùi ƒë·∫•t ∆°i ${name} ∆°i! C√¢u s∆° sinh th·∫ø n√†y m√† c≈©ng ch·ªçn sai ƒë∆∞·ª£c √°?<br>
                   ${gender} l√†m t√¥i th·∫•t v·ªçng qu√° ƒëi th√¥i! ü§£<br>
                   <b>(Thua t·∫°i c√¢u ${qNum} - Rank: G√† M·ªù)</b>`;
        } else if (qNum <= 10) {
            msg = `Non v√† xanh l·∫Øm ${name} √†!<br>
                   ƒê·ªãnh v∆∞·ª£t ·∫£i nh∆∞ng cu·ªôc ƒë·ªùi n√†y to√†n c√∫ l·ª´a th√¥i.<br>
                   ƒê·ª´ng cay c√∫ nh√© ${gender}! üòú<br>
                   <b>(Thua t·∫°i c√¢u ${qNum} - Rank: T·∫≠p S·ª±)</b>`;
        } else if (qNum < 15) {
            msg = `ƒêau! Qu√° ƒëau cho ƒë·ªôi b√°n cau!<br>
                   ${name} ƒë√£ ƒëi r·∫•t xa nh∆∞ng xui x·∫ªo th√¥i.<br>
                   Ch√∫t x√≠u n·ªØa l√† th√†nh huy·ªÅn tho·∫°i r·ªìi!<br>
                   <b>(Thua t·∫°i c√¢u ${qNum} - Rank: Cao Th·ªß)</b>`;
        }

        this.showEndScreen(title, msg);
    },

    victory() {
        const { name } = this.user;
        this.showEndScreen(
            "üèÜ HUY·ªÄN THO·∫†I", 
            `B√°i ph·ª•c! B√°i ph·ª•c!<br>
             ${name} ch√≠nh l√† b·ªô n√£o thi√™n t√†i c·ªßa th·∫ø k·ª∑ n√†y.<br>
             Admin xin ƒë∆∞·ª£c nh·∫≠n m·ªôt l·∫°y! üôè`
        );
    },

    showEndScreen(title, msg) {
        document.getElementById('screen-play').classList.add('hidden');
        document.getElementById('screen-start').classList.remove('hidden');
        // Reset giao di·ªán start screen ƒë·ªÉ hi·ªán th√¥ng b√°o thua
        const startDiv = document.getElementById('screen-start');
        startDiv.innerHTML = `
            <div style="flex-grow:1; display:flex; flex-direction:column; justify-content:center;">
                <h1 style="color:var(--wrong); font-size:2em">${title}</h1>
                <div style="font-size:1.1em; margin:20px; line-height:1.5; color:#ddd">${msg}</div>
                <button class="btn-main" onclick="location.reload()">Ch∆°i l·∫°i cho ƒë·ª° cay</button>
            </div>
            <div class="intro-text">
                Mini game by NCT<br>Ch√∫c b·∫°n may m·∫Øn l·∫ßn sau!
            </div>
        `;
    },

    useLife(type) {
        if(!this.lifelines[type]) return;
        const btn = document.getElementById('btn-'+type);
        if(btn.classList.contains('locked')) return;

        this.lifelines[type] = false;
        btn.classList.add('used');
        btn.onclick = null;
        this.isPaused = true;

        const qData = this.questions[this.currentQ];
        const correctChar = String.fromCharCode(65 + qData.c);
        let title = "", content = "";

        switch(type) {
            case '5050':
                this.isPaused = false;
                const wrong = [0,1,2,3].filter(x => x !== qData.c);
                const remove = wrong.sort(()=>Math.random()-.5).slice(0,2);
                document.querySelectorAll('.option').forEach((el, i) => {
                    if(remove.includes(i)) el.classList.add('hidden-50');
                });
                return;
            case 'phone':
                title = "üìû G·ªåI NG∆Ø·ªúI TH√ÇN";
                const rd = Math.random();
                if(rd > 0.4) content = `Alo ${this.user.name} √†? B·ªë v·ª´a tra ChatGPT xong, n√≥ b·∫£o ƒë√°p √°n l√† <b>${correctChar}</b>. Tin hay kh√¥ng t√πy con!`;
                else content = `T√∫t... t√∫t... Thu√™ bao qu√Ω kh√°ch v·ª´a g·ªçi hi·ªán ƒëang b·∫≠n ƒëi nh·∫≠u, vui l√≤ng t·ª± ch·ªçn b·ª´a! (ƒêen th√¥i)`;
                break;
            case 'audience':
                title = "üë• KH√ÅN GI·∫¢ TR∆Ø·ªúNG QUAY";
                content = `98% kh√°n gi·∫£ (to√†n gi√°o s∆∞) ƒë·ªÅu ch·ªçn ƒë√°p √°n <b>${correctChar}</b>.<br>H·ªç b·∫£o ai ch·ªçn kh√°c l√† "ng∆∞·ªùi sao H·ªèa"!`;
                break;
            case 'expert':
                title = "üßô T·ªî T∆Ø V·∫§N C·∫§P CAO";
                content = `<b>GS. Xoay:</b> "T√¥i th·ªÅ danh d·ª± l√† <b>${correctChar}</b>."<br><b>TS. Bi·∫øt Tu·ªët:</b> "Kh√¥ng ƒë√∫ng t√¥i ƒëi ƒë·∫ßu xu·ªëng ƒë·∫•t!"`;
                break;
        }
        this.showOverlay(title, content);
    },

    showOverlay(t, c) {
        const ov = document.getElementById('overlay');
        ov.classList.remove('hidden');
        document.getElementById('ov-title').innerHTML = t;
        document.getElementById('ov-content').innerHTML = c;
    },
    closeOverlay() {
        document.getElementById('overlay').classList.add('hidden');
        this.isPaused = false;
    },
    resetUI() {
        document.querySelectorAll('.life-btn').forEach(b => {
            b.classList.remove('used');
            b.classList.remove('locked');
        });
    }
};
</script>
</body>
</html>
