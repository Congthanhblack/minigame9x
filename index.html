<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>15 C√¢u Sinh T·ª≠ - NCT9x Master</title>
    <style>
        :root { --gold: #f1c40f; --blue: #3498db; --dark: #020230; --red: #e74c3c; --green: #2ecc71; --purple: #9b59b6; }
        body { margin:0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--dark); color:#fff; display:flex; justify-content:center; align-items:center; min-height:100vh; overflow: hidden; user-select: none; }
        
        .box { width: 95%; max-width: 500px; background: #000; border: 2px solid var(--gold); border-radius: 20px; padding: 20px; box-shadow: 0 0 40px rgba(241, 196, 15, 0.2); position: relative; transition: all 0.3s; }
        
        h1 { text-align: center; color: var(--gold); margin: 5px 0 20px 0; text-transform: uppercase; letter-spacing: 1px; font-size: 1.8em; }
        
        /* Input T√™n */
        .input-group { margin-bottom: 20px; text-align: center; }
        input { width: 70%; padding: 12px; background: #111; border: 2px solid #444; color: var(--gold); border-radius: 10px; font-size: 1.2em; outline: none; transition: 0.3s; text-align: center; font-weight: bold; text-transform: capitalize; }
        input:focus { border-color: var(--gold); box-shadow: 0 0 15px rgba(241, 196, 15, 0.3); }

        /* Lifelines Bar */
        .lifelines { display: flex; justify-content: space-between; margin-bottom: 15px; padding: 0 10px; }
        .life-btn { background: #111; border: 2px solid var(--gold); color: var(--gold); width: 50px; height: 50px; border-radius: 50%; font-size: 1.5em; cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center; position: relative; }
        .life-btn:hover { background: var(--gold); color: #000; transform: scale(1.1); }
        .life-btn.used { filter: grayscale(1); opacity: 0.4; cursor: not-allowed; border-color: #555; pointer-events: none; }
        .life-btn.used::after { content: '‚ùå'; position: absolute; font-size: 1.2em; color: red; }

        /* Timer & Question */
        #timer { font-size: 2.2em; text-align: center; font-weight: bold; color: var(--red); text-shadow: 0 0 10px var(--red); margin: 5px 0; font-family: monospace; }
        
        .options-grid { display: grid; gap: 10px; margin-top: 15px; }
        .option { padding: 12px; border: 1px solid var(--blue); border-radius: 8px; cursor: pointer; transition: 0.2s; background: rgba(52, 152, 219, 0.1); display: flex; align-items: center; min-height: 40px; }
        .option:hover { background: rgba(52, 152, 219, 0.3); transform: translateX(5px); }
        .option.correct { background: var(--green) !important; border-color: #fff; color: #000; font-weight: bold; animation: pulse 0.5s; }
        .option.wrong { background: var(--red) !important; border-color: #fff; opacity: 0.9; }
        .option.hidden-50 { opacity: 0; pointer-events: none; visibility: hidden; } /* ·∫®n h·∫≥n lu√¥n */

        /* Modal / Overlay for Lifelines */
        #overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10; display: flex; flex-direction: column; justify-content: center; align-items: center; border-radius: 18px; text-align: center; padding: 20px; box-sizing: border-box; }
        #overlay h3 { color: var(--gold); margin-top: 0; font-size: 1.5em; }
        #overlay p { font-size: 1.1em; line-height: 1.5; color: #fff; }
        .close-btn { margin-top: 20px; padding: 10px 30px; background: var(--blue); border: none; color: #fff; border-radius: 5px; cursor: pointer; font-weight: bold; }

        .btn { width: 100%; padding: 14px; margin-top: 20px; border-radius: 8px; border: 2px solid var(--gold); background: var(--gold); color: #000; font-weight: bold; cursor: pointer; transition: 0.3s; text-transform: uppercase; font-size: 1em; }
        .btn:hover { background: #fff; border-color: #fff; box-shadow: 0 0 15px #fff; }

        #explain { color: var(--gold); margin-top: 15px; font-style: italic; text-align: center; background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; font-size: 0.9em; }
        .hidden { display: none !important; }
        .nct-signature { text-align: center; font-size: 0.7em; opacity: 0.5; margin-top: 15px; font-style: italic; color: var(--gold); }
        .disabled { pointer-events: none; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

<div class="box">
    <div id="screen-start">
        <h1>üß† 15 C√ÇU SINH T·ª¨</h1>
        <div class="input-group">
            <input type="text" id="inp-name" placeholder="Nh·∫≠p t√™n b·∫°n (VD: Linh)" autocomplete="off" onkeypress="handleEnter(event)">
        </div>
        <div class="rule-list" style="color:#ccc; font-size:0.9em; line-height:1.6; margin-bottom:20px; background:rgba(255,255,255,0.05); padding:15px; border-radius:10px;">
            üíé <b>LU·∫¨T CH∆†I M·ªöI:</b><br>
            ‚Ä¢ 4 quy·ªÅn tr·ª£ gi√∫p c·ª±c m·∫°nh.<br>
            ‚Ä¢ D√πng tr·ª£ gi√∫p = 99% Qua m√†n.<br>
            ‚Ä¢ <b>20 gi√¢y</b> suy nghƒ©.<br>
            ‚Ä¢ V∆∞·ª£t qua c√¢u 15 ƒë·ªÉ th√†nh Huy·ªÅn Tho·∫°i.
        </div>
        <button class="btn" onclick="game.start()">CHI·∫æN NGAY</button>
        <div class="nct-signature">Phi√™n b·∫£n NCT9x Master ‚ú®</div>
    </div>

    <div id="screen-play" class="hidden">
        <div class="lifelines">
            <button class="life-btn" id="btn-5050" onclick="game.life5050()" title="50:50">‚öñÔ∏è</button>
            <button class="life-btn" id="btn-phone" onclick="game.lifePhone()" title="G·ªçi ng∆∞·ªùi th√¢n">üìû</button>
            <button class="life-btn" id="btn-audience" onclick="game.lifeAudience()" title="H·ªèi kh√°n gi·∫£">üë•</button>
            <button class="life-btn" id="btn-expert" onclick="game.lifeExpert()" title="T·ªï t∆∞ v·∫•n">üßô</button>
        </div>

        <div style="display: flex; justify-content: space-between; align-items: center; color: var(--gold); border-bottom: 1px solid #333; padding-bottom: 5px;">
            <span id="player-display" style="font-weight: bold;"></span>
            <span id="progress" style="font-size:0.9em;">C√ÇU 1/15</span>
        </div>
        
        <div id="timer">20</div>
        <p id="question" style="font-size: 1.2em; text-align: center; min-height: 60px; font-weight: 500; margin: 10px 0;"></p>
        
        <div class="options-grid" id="options"></div>
        <div id="explain" class="hidden"></div>
    </div>

    <div id="overlay" class="hidden">
        <h3 id="overlay-title"></h3>
        <div id="overlay-content"></div>
        <button class="close-btn" onclick="game.closeOverlay()">ƒê√É HI·ªÇU</button>
    </div>

    <div id="screen-result" class="hidden">
        <h1 id="res-title" style="font-size: 2em;"></h1>
        <p id="res-msg" style="text-align: center; line-height: 1.6; font-size: 1.1em; padding: 10px;"></p>
        <button class="btn" onclick="location.reload()">CH∆†I L·∫†I T·ª™ ƒê·∫¶U</button>
        <div class="nct-signature">NCT9x ch√∫c b·∫°n may m·∫Øn l·∫ßn sau ‚ú®</div>
    </div>
</div>

<script>
/* ================== DATABASE (80 C√ÇU) ================== */
const DB = [
    // EASY (M·∫πo & Ki·∫øn th·ª©c c∆° b·∫£n)
    {l:"easy", q:"Th√°ng n√†o ng·∫Øn nh·∫•t trong nƒÉm?", o:["Th√°ng 5","Th√°ng 2","Th√°ng 12","Th√°ng 10"], c:1},
    {l:"easy", q:"Con g√¨ c√†ng to c√†ng nh·ªè?", o:["Con cua","Con voi","Con ki·∫øn","Con d·ªëc"], c:0},
    {l:"easy", q:"B√°nh ch∆∞ng h√¨nh g√¨?", o:["Tr√≤n","Vu√¥ng","Tam gi√°c","Ch·ªØ nh·∫≠t"], c:1},
    {l:"easy", q:"M·∫∑t tr·ªùi m·ªçc h∆∞·ªõng n√†o?", o:["T√¢y","Nam","B·∫Øc","ƒê√¥ng"], c:3},
    {l:"easy", q:"Xe m√°y c√≥ m·∫•y b√°nh?", o:["1","2","3","4"], c:1},
    {l:"easy", q:"C√°i g√¨ ƒëi l√™n m√† kh√¥ng bao gi·ªù ƒëi xu·ªëng?", o:["M∆∞a","Tu·ªïi","C·∫ßu thang","Gi√° xƒÉng"], c:1},
    {l:"easy", q:"Th·ªß ƒë√¥ c·ªßa Vi·ªát Nam?", o:["S√†i G√≤n","ƒê√† N·∫µng","H√† N·ªôi","Hu·∫ø"], c:2},
    {l:"easy", q:"Ai l√† t√°c gi·∫£ Truy·ªán Ki·ªÅu?", o:["Nguy·ªÖn Khuy·∫øn","Nguy·ªÖn Du","T·ªë H·ªØu","Xu√¢n Di·ªáu"], c:1},
    {l:"easy", q:"1 t√° l√† bao nhi√™u c√°i?", o:["10","12","100","20"], c:1},
    {l:"easy", q:"L√° c·ªù Vi·ªát Nam c√≥ m√†u g√¨?", o:["Xanh","ƒê·ªè","V√†ng","T√≠m"], c:1},
    {l:"easy", q:"C√° heo l√† lo√†i g√¨?", o:["C√°","Th√∫","Chim","B√≤ s√°t"], c:1},
    {l:"easy", q:"S·ªë 0 La M√£ vi·∫øt l√†?", o:["O","Z","Kh√¥ng c√≥","X"], c:2},
    {l:"easy", q:"Con g√† c√≥ m·∫•y ch√¢n?", o:["1","2","4","0"], c:1},
    {l:"easy", q:"Th√°ng 2 nƒÉm nhu·∫≠n c√≥ m·∫•y ng√†y?", o:["28","29","30","31"], c:1},
    {l:"easy", q:"ƒê·ªânh n√∫i cao nh·∫•t Vi·ªát Nam?", o:["B√† ƒêen","Fansipan","Ng·ªçc Linh","Langbiang"], c:1},
    {l:"easy", q:"Bi·ªÉn s·ªë 29 l√† ·ªü ƒë√¢u?", o:["H√† N·ªôi","TP.HCM","ƒê√† N·∫µng","H·∫£i Ph√≤ng"], c:0},
    {l:"easy", q:"N∆∞·ªõc n√†o c√≥ di·ªán t√≠ch nh·ªè nh·∫•t th·∫ø gi·ªõi?", o:["Monaco","Vatican","Singapore","Nauru"], c:1},
    {l:"easy", q:"Google l√† c√¥ng ty c·ªßa n∆∞·ªõc n√†o?", o:["Anh","M·ªπ","Trung Qu·ªëc","Nh·∫≠t"], c:1},
    {l:"easy", q:"Lo√†i v·∫≠t n√†o ƒë∆∞·ª£c g·ªçi l√† ch√∫a s∆°n l√¢m?", o:["H·ªï","S∆∞ t·ª≠","Voi","G·∫•u"], c:0},
    {l:"easy", q:"Qu·∫£ g√¨ 5 m√∫i 4 khe?", o:["Qu·∫£ kh·∫ø","Qu·∫£ cam","Qu·∫£ cau","Qu·∫£ ƒë·∫•t"], c:0},
    
    // MEDIUM
    {l:"medium", q:"S√¥ng n√†o d√†i nh·∫•t th·∫ø gi·ªõi?", o:["Amazon","Nile","M√™ K√¥ng","D∆∞∆°ng T·ª≠"], c:1},
    {l:"medium", q:"T√°c gi·∫£ b√†i 'Ti·∫øn Qu√¢n Ca'?", o:["Ph·∫°m Tuy√™n","VƒÉn Cao","Tr·ªãnh C√¥ng S∆°n","Ho√†ng Vi·ªát"], c:1},
    {l:"medium", q:"ƒê√†n b·∫ßu c√≥ m·∫•y d√¢y?", o:["1 d√¢y","2 d√¢y","3 d√¢y","6 d√¢y"], c:0},
    {l:"medium", q:"World Cup 2022 t·ªï ch·ª©c ·ªü ƒë√¢u?", o:["Nga","Qatar","Ph√°p","Brazil"], c:1},
    {l:"medium", q:"Kh√≠ n√†o duy tr√¨ s·ª± ch√°y?", o:["Nit∆°","Oxy","Hydro","Cacbonic"], c:1},
    {l:"medium", q:"Ai t√¨m ra Ch√¢u M·ªπ?", o:["Colombo","Magellan","Cook","Vasco da Gama"], c:0},
    {l:"medium", q:"T√≤a th√°p cao nh·∫•t th·∫ø gi·ªõi hi·ªán nay?", o:["Landmark 81","Burj Khalifa","Shanghai Tower","Eiffel"], c:1},
    {l:"medium", q:"Qu·ªëc gia n√†o h√¨nh chi·∫øc ·ªßng?", o:["Ph√°p","√ù","Anh","T√¢y Ban Nha"], c:1},
    {l:"medium", q:"Th√†nh ph·ªë hoa ph∆∞·ª£ng ƒë·ªè?", o:["H·∫£i Ph√≤ng","H√† N·ªôi","ƒê√† N·∫µng","C·∫ßn Th∆°"], c:0},
    {l:"medium", q:"H√†nh tinh n√†o g·∫ßn M·∫∑t Tr·ªùi nh·∫•t?", o:["Sao Kim","Sao Th·ªßy","Sao H·ªèa","Tr√°i ƒê·∫•t"], c:1},
    {l:"medium", q:"ƒê∆°n v·ªã ƒëo c∆∞·ªùng ƒë·ªô d√≤ng ƒëi·ªán?", o:["V√¥n","Ampe","O√°t","Joule"], c:1},
    {l:"medium", q:"Lo√†i chim n√†o bi·∫øt bay l√πi?", o:["ƒê√† ƒëi·ªÉu","Chim ru·ªìi","ƒê·∫°i b√†ng","Chim s·∫ª"], c:1},
    {l:"medium", q:"Kim t·ª± th√°p Giza ·ªü ƒë√¢u?", o:["Ai C·∫≠p","Mexico","·∫§n ƒê·ªô","Peru"], c:0},
    {l:"medium", q:"T·∫Øt ƒê√®n l√† c·ªßa ai?", o:["Nam Cao","Ng√¥ T·∫•t T·ªë","V≈© Tr·ªçng Ph·ª•ng","T√¥ Ho√†i"], c:1},
    {l:"medium", q:"C·∫ßu th·ªß b√≥ng ƒë√° n√†o c√≥ bi·ªát danh El Pulga?", o:["Ronaldo","Messi","Neymar","Mbappe"], c:1},

    // HARD
    {l:"hard", q:"S·ªë n√†o v·ª´a l√† s·ªë ch√≠nh ph∆∞∆°ng v·ª´a l√† l·∫≠p ph∆∞∆°ng?", o:["16","64","81","100"], c:1},
    {l:"hard", q:"H√†nh tinh n√†o quay ng∆∞·ª£c chi·ªÅu kim ƒë·ªìng h·ªì?", o:["Sao Th·ªßy","Sao Kim","Sao H·ªèa","Sao M·ªôc"], c:1},
    {l:"hard", q:"Qu·ªëc gia n√†o c√≥ nhi·ªÅu m√∫i gi·ªù nh·∫•t?", o:["Nga","M·ªπ","Ph√°p","Trung Qu·ªëc"], c:2},
    {l:"hard", q:"Gi·∫£i Nobel kh√¥ng c√≥ lƒ©nh v·ª±c n√†o?", o:["To√°n h·ªçc","VƒÉn h·ªçc","H√≤a b√¨nh","V·∫≠t l√Ω"], c:0},
    {l:"hard", q:"V·ªã vua tr·ªã v√¨ ng·∫Øn nh·∫•t s·ª≠ Vi·ªát?", o:["D·ª•c ƒê·ª©c","Hi·ªáp H√≤a","Ki·∫øn Ph√∫c","ƒê·ªìng Kh√°nh"], c:0},
    {l:"hard", q:"Bi·ªÉn n√†o m·∫∑n nh·∫•t th·∫ø gi·ªõi?", o:["Bi·ªÉn ƒê·ªè","Bi·ªÉn Ch·∫øt","Bi·ªÉn ƒêen","Bi·ªÉn ƒê√¥ng"], c:1},
    {l:"hard", q:"Ng√¥n ng·ªØ l·∫≠p tr√¨nh C ra ƒë·ªùi nƒÉm n√†o?", o:["1969","1972","1980","1991"], c:1},
    {l:"hard", q:"Ai l√† ng∆∞·ªùi ƒë·∫ßu ti√™n bay v√†o v≈© tr·ª•?", o:["Armstrong","Gagarin","Aldrin","Ph·∫°m Tu√¢n"], c:1},
    {l:"hard", q:"T√™n c≈© c·ªßa Th√°i Lan?", o:["Mi·∫øn ƒêi·ªán","Xi√™m","Champa","L√†o"], c:1},
    {l:"hard", q:"Ng√†y h·∫° ch√≠ ·ªü b√°n c·∫ßu B·∫Øc?", o:["21/3","21/6","23/9","22/12"], c:1}
];

/* ================== GAME LOGIC ================== */
const game = {
    index: 0,
    pack: [],
    timer: 20,
    interval: null,
    lockedIds: JSON.parse(localStorage.getItem("NCT_MASTER") || "[]"),
    user: { name: "", gender: "other" },
    lifelines: { '5050': true, 'phone': true, 'audience': true, 'expert': true },
    isPaused: false, // ƒê·ªÉ t·∫°m d·ª´ng th·ªùi gian khi hi·ªán g·ª£i √Ω

    start() {
        const name = document.getElementById('inp-name').value.trim();
        if(!name){ alert("Nh·∫≠p c√°i t√™n v√†o ƒë√£ b·∫°n ∆°i!"); return; }

        this.user.name = name;
        this.user.gender = this.detectGender(name);
        
        // Reset lifelines UI
        document.querySelectorAll('.life-btn').forEach(btn => btn.classList.remove('used'));
        this.lifelines = { '5050': true, 'phone': true, 'audience': true, 'expert': true };

        this.pack = this.buildPack();
        if(this.pack.length < 15) {
            if(confirm("H·∫øt c√¢u h·ªèi r·ªìi! Reset ƒë·ªÉ ch∆°i l·∫°i t·ª´ ƒë·∫ßu nh√©?")) {
                localStorage.removeItem("NCT_MASTER");
                location.reload();
            }
            return;
        }

        document.getElementById('screen-start').classList.add('hidden');
        document.getElementById('screen-play').classList.remove('hidden');
        document.getElementById('player-display').innerText = `Ng∆∞·ªùi ch∆°i: ${this.user.name}`;
        
        this.loadQuestion();
    },

    // AI Detect Gender Logic (Optimized for First Name)
    detectGender(name) {
        const n = name.toLowerCase();
        const males = ['h√πng','c∆∞·ªùng','d≈©ng','nam','t√πng','s∆°n','ƒë·ª©c','th·∫Øng','minh','hi·∫øu','huy','long','kh√°nh','ƒë·∫°t','tu·∫•n','trung','th√†nh','quang','vinh','ki√™n','ho√†ng','ph√∫c','l√¢m','khoa','vi·ªát','t√†i','h·∫£i','nghƒ©a','b·∫£o'];
        const females = ['lan','hu·ªá','mai','c√∫c','tr√∫c','ƒë√†o','ly','h∆∞∆°ng','h·∫±ng','huy·ªÅn','trang','th·∫£o','vy','linh','ph∆∞∆°ng','nhung','thu','th·ªßy','h√†','h·∫°nh','hi·ªÅn','dung','trinh','tuy·∫øt','nhi','h√¢n','th∆∞','y·∫øn','qu·ª≥nh','hoa','tr√¢m','uy√™n','di·ªÖm','th√∫y','ki·ªÅu','nga','ng√¢n','ch√¢u','anh','oanh','v√¢n'];
        
        if(males.includes(n)) return 'male';
        if(females.includes(n)) return 'female';
        return 'other';
    },

    buildPack() {
        const available = DB.filter(q => !this.lockedIds.includes(q.q));
        const get = (lvl, n) => available.filter(q => q.l === lvl).sort(() => Math.random() - 0.5).slice(0, n);
        const pack = [...get('easy',5), ...get('medium',5), ...get('hard',5)];
        return pack.length === 15 ? pack : [];
    },

    loadQuestion() {
        clearInterval(this.interval);
        this.isPaused = false;
        const q = this.pack[this.index];
        this.timer = 20;
        
        document.getElementById('timer').innerText = this.timer;
        document.getElementById('progress').innerText = `C√ÇU ${this.index + 1}/15`;
        document.getElementById('question').innerText = q.q;
        document.getElementById('explain').classList.add('hidden');
        
        const optBox = document.getElementById('options');
        optBox.innerHTML = '';
        optBox.classList.remove('disabled');

        q.o.forEach((t, i) => {
            const div = document.createElement('div');
            div.className = 'option';
            div.innerHTML = `<b style="color:var(--gold); margin-right:10px">${String.fromCharCode(65+i)}.</b> ${t}`;
            div.onclick = () => this.check(i);
            optBox.appendChild(div);
        });

        this.interval = setInterval(() => {
            if(!this.isPaused) {
                this.timer--;
                document.getElementById('timer').innerText = this.timer;
                if(this.timer <= 0) this.lose(true);
            }
        }, 1000);
    },

    /* === 4 QUY·ªÄN TR·ª¢ GI√öP (ƒê·∫¢M B·∫¢O QUA) === */
    
    // 1. 50:50
    life5050() {
        if(!this.lifelines['5050']) return;
        this.markUsed('btn-5050', '5050');
        const q = this.pack[this.index];
        const wrongIdx = [0,1,2,3].filter(i => i !== q.c).sort(()=>Math.random()-0.5).slice(0,2);
        const opts = document.querySelectorAll('.option');
        wrongIdx.forEach(i => opts[i].classList.add('hidden-50'));
    },

    // 2. G·ªçi ƒëi·ªán (Ch·ªâ th·∫≥ng ƒë√°p √°n)
    lifePhone() {
        if(!this.lifelines['phone']) return;
        this.markUsed('btn-phone', 'phone');
        this.isPaused = true;
        
        const q = this.pack[this.index];
        const letter = String.fromCharCode(65 + q.c);
        const ans = q.o[q.c];
        
        let msg = "";
        if(this.user.gender === 'male') msg = `Alo ƒë·∫°i ca √†? Em tra Google r·ªìi, ch·∫Øc ch·∫Øn l√† <b>${letter}: ${ans}</b> nh√©. Sai ch·∫∑t ƒë·∫ßu em ƒëi!`;
        else if(this.user.gender === 'female') msg = `Ch·ªã ƒë·∫πp ∆°i, em h·ªèi c·∫£ l√†ng r·ªìi. ƒê√°p √°n l√† <b>${letter}: ${ans}</b> nh√©. Ch·ªçn sai l√† em d·ªói ƒë·∫•y!`;
        else msg = `Alo, theo ngu·ªìn tin m·∫≠t t·ª´ NASA th√¨ ƒë√°p √°n l√† <b>${letter}: ${ans}</b> nh√© b·∫°n m√¨nh ∆°i!`;

        this.showOverlay("üìû NG∆Ø·ªúI TH√ÇN M√ÅCH N∆Ø·ªöC", msg);
    },

    // 3. Kh√°n gi·∫£ (Bi·ªÉu ƒë·ªì ch·ªâ th·∫≥ng ƒë√°p √°n)
    lifeAudience() {
        if(!this.lifelines['audience']) return;
        this.markUsed('btn-audience', 'audience');
        this.isPaused = true;
        
        const q = this.pack[this.index];
        let stats = [0,0,0,0];
        // T·∫°o ch·ªâ s·ªë ·∫£o: ƒê√°p √°n ƒë√∫ng 85-95%, c√≤n l·∫°i chia nhau
        stats[q.c] = Math.floor(Math.random() * 10) + 85; 
        let remain = 100 - stats[q.c];
        for(let i=0; i<4; i++) {
            if(i !== q.c) {
                let v = Math.floor(Math.random() * remain);
                stats[i] = v;
                remain -= v;
            }
        }
        
        let chartHTML = `<div style="display:flex; justify-content:space-around; align-items:flex-end; height:150px; margin-top:20px;">`;
        stats.forEach((val, i) => {
            const isC = i === q.c;
            chartHTML += `
                <div style="width:40px; text-align:center;">
                    <div style="height:${val}px; background:${isC ? 'var(--green)' : '#555'}; margin:0 auto; width:20px; border-radius:3px 3px 0 0;"></div>
                    <div style="margin-top:5px; font-weight:bold;">${String.fromCharCode(65+i)}</div>
                    <div style="font-size:0.8em; color:${isC ? 'var(--green)':'#aaa'}">${val}%</div>
                </div>`;
        });
        chartHTML += `</div>`;
        
        this.showOverlay("üë• √ù KI·∫æN KH√ÅN GI·∫¢", `Kh√°n gi·∫£ t·∫°i tr∆∞·ªùng quay ƒë√£ b√¨nh ch·ªçn:<br>${chartHTML}`);
    },

    // 4. T·ªï t∆∞ v·∫•n (Chuy√™n gia ph√°n)
    lifeExpert() {
        if(!this.lifelines['expert']) return;
        this.markUsed('btn-expert', 'expert');
        this.isPaused = true;
        
        const q = this.pack[this.index];
        const letter = String.fromCharCode(65 + q.c);
        
        const content = `
            <div style="text-align:left; background:rgba(255,255,255,0.1); padding:10px; border-radius:5px; margin-bottom:5px;">
                üßî <b>GS. Xoay:</b> "C√¢u n√†y t√¥i nghi√™n c·ª©u 10 nƒÉm r·ªìi, ch·∫Øc ch·∫Øn l√† <b>${letter}</b>."
            </div>
            <div style="text-align:left; background:rgba(255,255,255,0.1); padding:10px; border-radius:5px;">
                üë©‚Äçüè´ <b>TS. NCT9x:</b> "ƒê·ªìng √Ω ho√†n to√†n! Ch·ªçn <b>${letter}</b> l√† qua m√†n nh√©!"
            </div>
        `;
        this.showOverlay("üßô T·ªî T∆Ø V·∫§N", content);
    },

    markUsed(btnId, key) {
        document.getElementById(btnId).classList.add('used');
        this.lifelines[key] = false;
    },

    showOverlay(title, content) {
        document.getElementById('overlay').classList.remove('hidden');
        document.getElementById('overlay-title').innerHTML = title;
        document.getElementById('overlay-content').innerHTML = content;
    },

    closeOverlay() {
        document.getElementById('overlay').classList.add('hidden');
        this.isPaused = false; // Ti·∫øp t·ª•c ƒë·∫øm gi·ªù
    },

    /* === CHECK & RESULT LOGIC === */
    check(i) {
        clearInterval(this.interval);
        const q = this.pack[this.index];
        const opts = document.querySelectorAll('.option');
        document.getElementById('options').classList.add('disabled');

        if(i === q.c) {
            opts[i].classList.add('correct');
            this.index++;
            setTimeout(() => {
                if(this.index === 15) this.win();
                else this.loadQuestion();
            }, 1000);
        } else {
            opts[i].classList.add('wrong');
            opts[q.c].classList.add('correct');
            this.saveProgress();
            setTimeout(() => this.lose(false), 2000);
        }
    },

    saveProgress() {
        const passed = this.pack.slice(0, this.index).map(q => q.q);
        this.lockedIds = [...new Set([...this.lockedIds, ...passed])];
        localStorage.setItem("NCT_MASTER", JSON.stringify(this.lockedIds));
    },

    lose(timeout) {
        const p = this.getPronoun();
        const n = this.user.name;
        let msg = "";

        if(this.index < 5) {
            if(this.user.gender === 'male') msg = `ƒê·∫°i ca ${n} ∆°i! C√¢u d·ªÖ th·∫ø n√†y m√† c≈©ng sai th√¨ h·ªèng h·∫øt b√°nh k·∫πo r·ªìi! üòÇ`;
            else if(this.user.gender === 'female') msg = `Ch·ªã ${n} xinh g√°i m√† sai c√¢u n√†y th√¨ ti·∫øc qu√° ƒëi m·∫•t! üíÑ`;
            else msg = `C√¢u n√†y tr·∫ª con c≈©ng bi·∫øt m√† b·∫°n ${n} l·∫°i sai ∆∞? Bu·ªìn gh√™!`;
        } else if (this.index < 10) {
            if(timeout) msg = `H·∫øt gi·ªù r·ªìi ${p} ${n} ∆°i! M·∫£i suy nghƒ© chuy·ªán kh√°c ph·∫£i kh√¥ng?`;
            else msg = `Sai m·ªôt ly ƒëi m·ªôt d·∫∑m. ${p} ${n} c·∫ßn b√¨nh tƒ©nh h∆°n nh√©!`;
        } else {
            msg = `Tr·ªùi ∆°i ti·∫øc qu√°! ${p} ${n} su√Ωt th√¨ th√†nh Huy·ªÅn Tho·∫°i r·ªìi.`;
        }
        this.endScreen(timeout ? "‚åõ H·∫æT GI·ªú" : "üíÄ GAME OVER", msg);
    },

    win() {
        this.saveProgress();
        const n = this.user.name;
        let msg = "";
        if(this.user.gender === 'male') msg = `ƒê·ªânh cao tr√≠ tu·ªá! ƒê·∫°i ca ${n} x·ª©ng danh l√† gi√°o s∆∞ bi·∫øt tu·ªët! üèÜ`;
        else if(this.user.gender === 'female') msg = `Tuy·ªát v·ªùi! N·ªØ th·∫ßn ${n} v·ª´a xinh v·ª´a gi·ªèi, ai m√† ch·ªãu n·ªïi! üëë`;
        else msg = `15/15! B·∫°n ${n} ch√≠nh l√† b·ªô n√£o thi√™n t√†i m√† NCT9x t√¨m ki·∫øm!`;

        this.endScreen("üëë HUY·ªÄN THO·∫†I", msg);
    },

    getPronoun() {
        if(this.user.gender === 'male') return "anh";
        if(this.user.gender === 'female') return "ch·ªã";
        return "b·∫°n";
    },

    endScreen(title, msg) {
        clearInterval(this.interval);
        document.getElementById('screen-play').classList.add('hidden');
        document.getElementById('screen-result').classList.remove('hidden');
        document.getElementById('res-title').innerText = title;
        document.getElementById('res-msg').innerHTML = msg;
    }
};

function handleEnter(e) { if(e.key === 'Enter') game.start(); }
// Focus input
document.getElementById('inp-name').focus();
</script>
</body>
</html>
