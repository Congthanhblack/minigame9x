<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI LÃ€ THÃNH NHá»Œ â€“ PARTY</title>

<style>
:root {
  --gold:#f1c40f;
  --red:#e74c3c;
  --blue:#0984e3;
  --dark:#020230;
}

body {
  margin:0;
  font-family: 'Segoe UI', sans-serif;
  background: radial-gradient(circle, #0a3d62, var(--dark));
  color:#fff;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}

.app {
  width:95%;
  max-width:520px;
  background:#000;
  border:3px solid var(--gold);
  border-radius:20px;
  padding:20px;
  box-shadow:0 0 30px rgba(241,196,15,.25);
}

h1,h2,h3 { text-align:center; color:var(--gold); }

input, select, button {
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:12px;
  font-size:1rem;
  box-sizing:border-box;
}

input, select {
  border:none;
}

button {
  background:transparent;
  border:2px solid var(--gold);
  color:#fff;
  font-weight:bold;
  cursor:pointer;
}

button:hover {
  background:var(--gold);
  color:#000;
}

.hidden { display:none; }

.timer {
  font-size:2.2rem;
  color:var(--red);
  text-align:center;
  margin-bottom:10px;
}

.option {
  margin-top:8px;
  background:rgba(255,255,255,.08);
  border:1px solid var(--blue);
}

.rank {
  background:rgba(255,255,255,.06);
  padding:8px;
  border-radius:8px;
  margin-top:6px;
  font-size:.95rem;
}
</style>
</head>

<body>
<div class="app">

<!-- ========== START SCREEN ========== -->
<div id="scr-start">
  <h1>ğŸº AI LÃ€ THÃNH NHá»Œ ğŸº</h1>

  <input id="playerName" placeholder="Nháº­p tÃªn ngÆ°á»i chÆ¡i">

  <select id="difficulty">
    <option value="easy">ğŸ˜Œ Dá»…</option>
    <option value="medium">ğŸ˜ Trung bÃ¬nh</option>
    <option value="hard">ğŸ˜ˆ KhÃ³</option>
  </select>

  <select id="gameType">
    <option value="normal">ğŸ¯ BÃ¬nh thÆ°á»ng</option>
    <option value="sudden">ğŸ’€ 1 cÃ¢u lÃ  cháº¿t</option>
  </select>

  <button onclick="startGame()">VÃ€O CUá»˜C ğŸš€</button>

  <div id="historyBox"></div>
</div>

<!-- ========== QUIZ SCREEN ========== -->
<div id="scr-quiz" class="hidden">
  <div class="timer" id="timer"></div>
  <h2 id="question"></h2>
  <div id="options"></div>
</div>

<!-- ========== RESULT SCREEN ========== -->
<div id="scr-result" class="hidden">
  <h1 id="resTitle"></h1>
  <p id="resDesc" style="text-align:center;font-weight:bold;"></p>
  <button onclick="location.reload()">ChÆ¡i tiáº¿p ğŸ”„</button>
</div>

</div>

<script>
/* ======================================================
   GLOBAL DATA & STATE
====================================================== */

const SETTINGS = {
  easy:   { time:18, drink:1 },
  medium: { time:15, drink:2 },
  hard:   { time:10, drink:3 }
};

let state = {
  player:"",
  level:"",
  gameType:"",
  step:0,
  timer:null,
  timeLeft:0,
  questions:[]
};

/* ======================================================
   PARTY PLAYERS & HISTORY
====================================================== */

let partyPlayers =
  JSON.parse(localStorage.getItem("party_players") || "[]");

let history =
  JSON.parse(localStorage.getItem("nct_history") || "[]");

/* ======================================================
   AI QUESTION GENERATOR
====================================================== */

function generateAIQuestion() {
  const names = partyPlayers.length
    ? partyPlayers
    : ["Äá»©a bÃªn trÃ¡i","Äá»©a bÃªn pháº£i","Chá»§ bÃ n","NgÆ°á»i cáº§m ly"];

  const traps = [
    "lÃ  ngÆ°á»i nhá» nháº¥t bÃ n",
    "uá»‘ng nhiá»u nháº¥t tá»‘i nay",
    "say Ä‘áº§u tiÃªn",
    "hay bá»‘c phÃ©t nháº¥t",
    "vá» sá»›m nháº¥t"
  ];

  let target = names[Math.floor(Math.random()*names.length)];
  let trap = traps[Math.floor(Math.random()*traps.length)];

  return {
    q: `${target} cÃ³ pháº£i lÃ  ${trap} khÃ´ng?`,
    o: ["ÄÃºng ğŸ˜ˆ","KhÃ´ng ğŸ¤”","KhÃ´ng dÃ¡m tráº£ lá»i ğŸ˜µ"],
    a: 0
  };
}

/* ======================================================
   GAME START
====================================================== */

function startGame() {
  const name = document.getElementById("playerName").value.trim();
  if(!name) {
    alert("Nháº­p tÃªn Ä‘Ã£ ğŸ˜ˆ");
    return;
  }

  state.player = name;
  state.level = document.getElementById("difficulty").value;
  state.gameType = document.getElementById("gameType").value;
  state.step = 0;
  state.questions = [];

  if (!partyPlayers.includes(name)) {
    partyPlayers.push(name);
    localStorage.setItem("party_players", JSON.stringify(partyPlayers));
  }

  document.getElementById("scr-start").classList.add("hidden");
  document.getElementById("scr-quiz").classList.remove("hidden");

  nextQuestion();
}

/* ======================================================
   QUIZ FLOW
====================================================== */

function nextQuestion() {
  if (state.gameType === "sudden" && state.step >= 1) {
    endGame(true);
    return;
  }

  state.questions[state.step] = generateAIQuestion();
  renderQuestion(state.questions[state.step]);
  startTimer();
}

function renderQuestion(q) {
  document.getElementById("question").innerText = q.q;
  const box = document.getElementById("options");
  box.innerHTML = "";

  q.o.forEach((opt,i)=>{
    let btn = document.createElement("button");
    btn.className = "option";
    btn.innerText = opt;
    btn.onclick = ()=>answer(i===q.a);
    box.appendChild(btn);
  });
}

/* ======================================================
   TIMER
====================================================== */

function startTimer() {
  clearInterval(state.timer);
  state.timeLeft = SETTINGS[state.level].time;
  document.getElementById("timer").innerText = state.timeLeft+"s";

  state.timer = setInterval(()=>{
    state.timeLeft--;
    document.getElementById("timer").innerText = state.timeLeft+"s";
    if (state.timeLeft <= 0) {
      answer(false);
    }
  },1000);
}

/* ======================================================
   ANSWER & RESULT
====================================================== */

function answer(correct) {
  clearInterval(state.timer);

  if (correct && state.gameType !== "sudden") {
    state.step++;
    nextQuestion();
  } else {
    endGame(correct);
  }
}

function endGame(win) {
  document.getElementById("scr-quiz").classList.add("hidden");
  document.getElementById("scr-result").classList.remove("hidden");

  let drinkTarget = getDrinkTarget();
  let drinkCount = SETTINGS[state.level].drink;

  if (!win) {
    history.push({
      name: state.player,
      level: state.level,
      mode: state.gameType,
      time: new Date().toLocaleTimeString()
    });
    localStorage.setItem("nct_history", JSON.stringify(history));
  }

  document.getElementById("resTitle").innerText =
    win ? "ğŸ¤´ THOÃT Náº N!" : "ğŸ¤® NHá»Œ Rá»’I!";

  document.getElementById("resDesc").innerText =
    win
      ? "Cáº£ bÃ n vá»— tay ğŸ‘"
      : drinkTarget === state.player
        ? `ğŸº ${state.player} uá»‘ng ${drinkCount} ngá»¥m!`
        : `ğŸ€ ${drinkTarget} uá»‘ng thay ${state.player} ${drinkCount} ngá»¥m!`;

  renderHistory();
}

/* ======================================================
   DRINK LOGIC
====================================================== */

function getDrinkTarget() {
  if (partyPlayers.length < 2) return state.player;

  if (Math.random() < 0.3) {
    let others = partyPlayers.filter(p=>p!==state.player);
    return others[Math.floor(Math.random()*others.length)];
  }
  return state.player;
}

/* ======================================================
   HISTORY (>=10 PLAYERS)
====================================================== */

function renderHistory() {
  if (partyPlayers.length < 10) return;

  const box = document.getElementById("historyBox");
  box.innerHTML = "<h3>ğŸ“œ Lá»ŠCH Sá»¬ NHá»Œ</h3>";

  history.slice(-10).reverse().forEach(h=>{
    box.innerHTML += `
      <div class="rank">
        ğŸ¤® ${h.name} | ${h.mode} | ${h.level} | ${h.time}
      </div>`;
  });
}

renderHistory();
</script>
</body>
</html>
